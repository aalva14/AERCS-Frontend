/****************************************************************************
 **
 ** This file is part of yFiles AJAX.
 **
 ** yWorks proprietary/confidential. Use is subject to license terms.
 **
 ** Unauthorized redistribution of this file and reverse engineering are
 ** strictly forbidden.
 **
 ** Copyright (c) 2006-2010 by yWorks GmbH, Vor dem Kreuzberg 28,
 ** 72070 Tuebingen, Germany. All rights reserved.
 **
 ***************************************************************************/

if(!dojo._hasResource["yfiles.client.tiles.Graph"]){dojo._hasResource["yfiles.client.tiles.Graph"]=true;dojo.provide("yfiles.client.tiles.Graph");dojo.declare("yfiles.client.tiles.Graph",null,{_name:null,_baseURL:null,constructor:function(_1,_2){if(_1){this._baseURL=_1;}else{this._baseURL=".";}if(_2){this._name=_2;this.load(_2);}},getName:function(){return this._name;},getBaseURL:function(){return this._baseURL;},load:function(_3,_4,_5){var _6={path:_3};if(_4){_6.reload="true";}var _7=this;dojo.xhrPost({url:this._baseURL+"/loadGraph",content:_6,load:function(_8,_9){_7._name=_3;_7.onLoad(_3,_5);},error:function(_a,_b){_7.onLoadFailed(_3,_5);}});},createNode:function(x,y,_c,_d){var _e={name:this._name,x:x,y:y};if(_c){_e.type=_c;}if(this._name){var _f=this;dojo.xhrPost({url:this._baseURL+"/createNode",content:_e,load:function(_10,_11){_f.onNodeCreated(_10.id,_10.bounds,this._name,x,y,_d);},error:function(_12,_13){_f.onNodeCreationFailed(_f._name,x,y,_d);},handleAs:"json"});}else{this.onNodeCreationFailed(null,x,y,_d);}},createEdge:function(_14,_15,_16,_17){if(this._name){var _18=this;var _19=_16?1:0;dojo.xhrPost({url:this._baseURL+"/createEdge",content:{name:this._name,source:_14,target:_15,route:_19},load:function(_1a,_1b){_18.onEdgeCreated(_1a.id,_1a.bounds,_18._name,_14,_15,_17);},error:function(_1c,_1d){_18.onEdgeCreationFailed(_18._name,_14,_15,_17);},handleAs:"json"});}else{this.onEdgeCreationFailed(null,_14,_15,_17);}},removeAt:function(x,y,_1e){if(this._name){var _1f=this;dojo.xhrPost({url:this._baseURL+"/removeAt?name="+this._name+"&x="+x+"&y="+y,load:function(_20,_21){_1f.onRemove([_20.id],_20.bounds,_1f._name,x,y,_1e);},error:function(_22,_23){_1f.onRemoveFailed([],_1f._name,x,y,_1e);},handleAs:"json"});}else{this.onRemoveFailed([],null,x,y,_1e);}},remove:function(ids,_24){if(this._name&&ids.length>0){var _25=ids[0];for(var i=1;i<ids.length;i++){_25=_25+","+ids[i];}var _26=this;dojo.xhrPost({url:this._baseURL+"/remove",content:{name:this._name,ids:_25},load:function(_27,_28){_26.onRemove(ids,_27.bounds,_26._name,_24);},error:function(_29,_2a){_26.onRemoveFailed(ids,_26._name,_24);},handleAs:"json"});}else{this.onRemoveFailed(ids,null,_24);}},moveNodes:function(_2b,x,y,_2c,_2d){if(this._name&&_2b.length>0){var ids=_2b[0];for(var i=1;i<_2b.length;i++){ids=ids+","+_2b[i];}var _2e=_2c?1:0;var _2f=this;dojo.xhrPost({url:this._baseURL+"/moveNodes",content:{name:this._name,ids:ids,x:x,y:y,route:_2e},load:function(_30,_31){_2f.onNodesMoved(_30.bounds,_2f._name,_2b,x,y,_2d);},error:function(_32,_33){_2f.onNodesMoveFailed(_2f._name,_2b,x,y,_2d);},handleAs:"json"});}else{this.onNodesMoveFailed(null,_2b,x,y,_2d);}},getLabel:function(id,_34,_35,_36,_37){if(this._name){var _38=this;dojo.xhrPost({url:this._baseURL+"/getLabel",content:{name:this._name,id:id},load:function(_39,_3a){_35.call(_34,_39,_38._name,id,_37);},error:function(_3b,_3c){if(_36){_36.call(_34,_38._name,id,_37);}},handleAs:"text"});}else{if(_36){_36.call(_34,null,id,_37);}}},setLabel:function(id,_3d,_3e){if(this._name){var _3f=this;var nl=encodeURIComponent(_3d);dojo.xhrPost({url:this._baseURL+"/setLabel",content:{name:this._name,id:id,"label":nl},load:function(_40,_41){_3f.onLabelSet(_3d,_3f._name,id,_3e);},error:function(_42,_43){_3f.onLabelSetFailed(_3d,_3f._name,id,_3e);},handleAs:"text"});}else{this.onLabelSetFailed(_3d,null,id,_3e);}},getBounds:function(_44,_45,_46,_47,_48){var _49={path:this._name};if(_47){_49.seq=_47;}if(this._name){var _4a=this;dojo.xhrGet({url:this._baseURL+"/getWorldBounds",content:_49,load:function(_4b,_4c){_45.call(_44,_4b,_4a._name,_48);},error:function(_4d,_4e){if(_46){_46.call(_44,_4a._name,_48);}},handleAs:"json"});}else{if(_46){_46.call(_44,null,_48);}}},onLoad:function(_4f,_50){},onLoadFailed:function(_51,_52){},onNodeCreated:function(id,_53,_54,x,y,_55){},onNodeCreationFailed:function(_56,x,y,_57){},onEdgeCreated:function(id,_58,_59,_5a,_5b,_5c){},onEdgeCreationFailed:function(_5d,_5e,_5f,_60){},onRemove:function(ids,_61,_62,x,y,_63){},onRemoveFailed:function(ids,_64,x,y,_65){},onNodesMoved:function(_66,_67,ids,x,y,_68){},onNodesMoveFailed:function(_69,ids,x,y,_6a){},onLabelSet:function(_6b,_6c,id,_6d){},onLabelSetFailed:function(_6e,_6f,id,_70){}});}if(!dojo._hasResource["yfiles.client.tiles.GraphBounds"]){dojo._hasResource["yfiles.client.tiles.GraphBounds"]=true;dojo.provide("yfiles.client.tiles.GraphBounds");dojo.declare("yfiles.client.tiles.GraphBounds",null,{minX:null,maxX:null,minY:null,maxY:null,constructor:function(_71,_72,_73,_74){this.minX=_71;this.maxX=_72;this.minY=_73;this.maxY=_74;},width:function(){return this.maxX-this.minX;},height:function(){return this.maxY-this.minY;},area:function(){return this.width()*this.height();},center:function(){return {x:this.minX+this.width()/2,y:this.minY+this.height()/2};},scale:function(_75){return new yfiles.client.tiles.GraphBounds(_75*this.minX,_75*this.maxX,_75*this.minY,_75*this.maxY);},round:function(){return new yfiles.client.tiles.GraphBounds(Math.floor(this.minX),Math.floor(this.maxX),Math.floor(this.minY),Math.floor(this.maxY));},union:function(_76){return new yfiles.client.tiles.GraphBounds(Math.min(this.minX,_76.minX),Math.max(this.maxX,_76.maxX),Math.min(this.minY,_76.minY),Math.max(this.maxY,_76.maxY));},intersect:function(_77){return new yfiles.client.tiles.GraphBounds(Math.max(this.minX,_77.minX),Math.min(this.maxX,_77.maxX),Math.max(this.minY,_77.minY),Math.min(this.maxY,_77.maxY));},shift:function(_78,_79){return new yfiles.client.tiles.GraphBounds(this.minX+_78,this.maxX+_78,this.minY+_79,this.maxY+_79);}});}if(!dojo._hasResource["yfiles.client.tiles.HitTest"]){dojo._hasResource["yfiles.client.tiles.HitTest"]=true;dojo.provide("yfiles.client.tiles.HitTest");dojo.declare("yfiles.client.tiles.HitTest",null,{_edgeTestSensitivity:5,_nodeEvents:false,_edgeEvents:false,_nodeLabelEvents:false,_edgeLabelEvents:false,_paperEvents:false,_baseURL:".",_path:null,_worldBounds:null,_nodes:null,_nodeLabels:null,_edges:null,_edgeLabels:null,_NODE_EVENTS:1,_EDGE_EVENTS:2,_NODE_LABEL_EVENTS:4,_EDGE_LABEL_EVENTS:8,_PAPER_EVENTS:16,_eventMask:0,constructor:function(_7a,_7b,_7c,_7d,_7e,_7f,_80,_81){this._baseURL=_7a;this._path=_7b;this._worldBounds=_7c;this.setEventTypes(_7d,_7e,_7f,_80,_81);},getGraphName:function(){return this._path;},getEventMask:function(){return this._eventMask;},setEventTypes:function(_82,_83,_84,_85,_86){this._createMaps();this._nodeEvents=_82;this._edgeEvents=_83;this._nodeLabelEvents=_84;this._edgeLabelEvents=_85;this._paperEvents=_86;if(this._nodeEvents){this._eventMask|=this._NODE_EVENTS;}if(this._edgeEvents){this._eventMask|=this._EDGE_EVENTS;}if(this._nodeLabelEvents){this._eventMask|=this._NODE_LABEL_EVENTS;}if(this._edgeLabelEvents){this._eventMask|=this._EDGE_LABEL_EVENTS;}this._getElementBounds();},setGraphParameters:function(_87,_88,_89,_8a){this._setParams(_87,_88,_89);if(_87||_88||_89){this.clear();this._getElementBounds(_89,_8a);}else{if(dojo.isFunction(_8a)){_8a(this._baseURL,this._path,this._worldBounds);}}},setData:function(_8b,_8c,_8d,_8e,_8f){this._setParams(_8d,_8e,_8f);this.clear();this._createGraph(_8b,_8c);},setEdgeTestSensitivity:function(_90){this._edgeTestSensitivity=_90;},getEmptyHitInfo:function(_91,_92){return {hit:false,x:_91,y:_92,nodes:[],edges:[],nodeLabels:[],edgeLabels:[]};},getHitInfo:function(_93,_94,_95){var res=this.getEmptyHitInfo(_93,_94);var hit=false;if(this._edgeLabelEvents){hit=this._rectangleHitTest(this._edgeLabels,_93,_94,_95,res.edgeLabels);}if(hit){res.firstHit=res.edgeLabels[0];res.hit=true;}if(res.hit&&_95){return res;}if(this._edgeEvents){hit=this._polyLineHitTest(this._edges,_93,_94,_95,res.edges);res.hit=res.hit||hit;}if(hit&&!res.firstHit){res.firstHit=res.edges[0];}if(res.hit&&_95){return res;}if(this._nodeLabelEvents){hit=this._rectangleHitTest(this._nodeLabels,_93,_94,_95,res.nodeLabels);res.hit=res.hit||hit;}if(hit&&!res.firstHit){res.firstHit=res.nodeLabels[0];}if(res.hit&&_95){return res;}if(this._nodeEvents){hit=this._rectangleHitTest(this._nodes,_93,_94,_95,res.nodes);res.hit=res.hit||hit;}if(hit&&!res.firstHit){res.firstHit=res.nodes[0];}if(res.hit&&_95){return res;}if(this._paperEvents){res.hit=true;}return res;},getOverlaps:function(x1,y1,x2,y2){var res=this.getEmptyHitInfo(x1,y1);if(this._nodeLabelEvents){this._rectangleOverlapTest(this._nodeLabels,x1,y1,x2,y2,res.nodeLabels);}if(this._nodeEvents){this._rectangleOverlapTest(this._nodes,x1,y1,x2,y2,res.nodes);}if(this._edgeLabelEvents){this._rectangleOverlapTest(this._edgeLabels,x1,y1,x2,y2,res.edgeLabels);}if(this._edgeEvents){this._polyLineOverlapTest(this._edges,x1,y1,x2,y2,res.edges);}return res;},getBoundsForId:function(id){var _96=this._byId(id);if(_96){if(_96.t!="e"){return yfiles.client.tiles.HitTest._getRectBounds(_96);}else{return yfiles.client.tiles.HitTest._getEdgeBounds(_96);}}else{return null;}},getControlPoints:function(_97){var _98=this._byId(_97);if(_98&&_98.t=="e"){return _98.p;}else{return null;}},getLabelInfo:function(_99){var _9a=this._byId(_99);if(!_9a){return null;}var idx=_99.lastIndexOf("-");if(idx){var _9b=_99.substring(2,idx);var _9c=_99.substring(0,1)+_9b;return {mainElementId:_9c,labelIndex:_9a.p};}else{return null;}},refresh:function(){this.clear();this._getElementBounds();},clear:function(){this._nodes.clear();this._nodeLabels.clear();this._edges.clear();this._edgeLabels.clear();},isActive:function(){return this._eventMask!=0;},onNewData:function(){},_createMaps:function(){this._nodes=new dojox.collections.Dictionary();this._nodeLabels=new dojox.collections.Dictionary();this._edges=new dojox.collections.Dictionary();this._edgeLabels=new dojox.collections.Dictionary();},_setParams:function(_9d,_9e,_9f){if(_9d){this._baseURL=_9d;}if(_9e){this._path=_9e;}if(_9f){this._worldBounds=_9f;}},_getElementBounds:function(_a0,_a1){var bb=_a0?_a0:this._worldBounds;var cb=dojo.isFunction(_a1)?_a1:function(a,b,c){};if(!bb||!this._path||this._path==""){cb(this._baseURL,this._path,this._worldBounds);return;}if(!this._nodeEvents&&!this._edgeEvents&&!this._nodeLabelEvents&&!this._edgeLabelEvents){cb(this._baseURL,this._path,this._worldBounds);return;}var _a2=this;dojo.xhrPost({url:this._baseURL+"/getElementBounds?path="+this._path+"&x="+bb.minX+"&y="+bb.minY+"&width="+bb.width()+"&height="+bb.height()+"&types="+this._eventMask,load:function(_a3,_a4){setTimeout(dojo.hitch(_a2,_a2._createGraph,_a3,cb),0);},handleAs:"json"});},_getCategory:function(_a5){switch(_a5.t){case "n":return this._nodes;case "nl":return this._nodeLabels;case "e":return this._edges;case "el":return this._edgeLabels;}return null;},_byId:function(id,_a6){if(_a6){return _a6.item(id);}var _a7=null;var _a8=[this._nodes,this._edges,this._nodeLabels,this._edgeLabels];for(var i=0;i<_a8.length;i++){_a6=_a8[i];_a7=_a6.item(id);if(_a7){return _a7;}}return null;},_createGraph:function(_a9,_aa){var cb=dojo.isFunction(_aa)?_aa:function(a,b,c){};var _ab=_a9.length;if(_ab>0){for(var i=0;i<_ab;i++){var _ac=_a9[i];setTimeout(dojo.hitch(this,this._createElement,_ac,i==_ab-1,cb),0);}}else{_aa(this._baseURL,this._path,this._worldBounds);}},_createElement:function(_ad,_ae,cb){var id=_ad.i;var _af=this._getCategory(_ad);_af.add(id,_ad);if(_ae){cb(this._baseURL,this._path,this._worldBounds);this.onNewData();}},_rectangleHitTest:function(_b0,_b1,_b2,_b3,_b4){var hit=false;var _b5=_b0.getIterator();var _b6=_b5.get();while(_b6){var _b7=_b6.value;if(_b7.x<=_b1&&_b7.x+_b7.w>=_b1&&_b7.y<=_b2&&_b7.y+_b7.h>=_b2){_b4.push(_b7);if(_b3){return true;}else{hit=true;}}_b6=_b5.get();}return hit;},_rectangleOverlapTest:function(_b8,x1,y1,x2,y2,_b9){var _ba=_b8.getIterator();var _bb=_ba.get();while(_bb){var _bc=_bb.value;if(this._rectangleIntersection(x1,y1,x2,y2,_bc.x,_bc.y,_bc.x+_bc.w,_bc.y+_bc.h)){_b9.push(_bc);}_bb=_ba.get();}},_rectangleIntersection:function(ax1,ay1,ax2,ay2,bx1,by1,bx2,by2){return (Math.max(ax1,bx1)<=Math.min(ax2,bx2)&&Math.max(ay1,by1)<=Math.min(ay2,by2));},_lineSegmentIntersection:function(ax1,ay1,ax2,ay2,bx1,by1,bx2,by2){var a1=ay2-ay1;var b1=ax1-ax2;var c1=a1*ax1+b1*ay1;var a2=by2-by1;var b2=bx1-bx2;var c2=a2*bx1+b2*by1;var det=a1*b2-a2*b1;if(Math.abs(det)<=1e-7){return false;}else{var x=(b2*c1-b1*c2)/det;var y=(a1*c2-a2*c1)/det;return (Math.min(ax1,ax2)<=x&&x<=Math.max(ax1,ax2)&&Math.min(ay1,ay2)<=y&&y<=Math.max(ay1,ay2)&&Math.min(bx1,bx2)<=x&&x<=Math.max(bx1,bx2)&&Math.min(by1,by2)<=y&&y<=Math.max(by1,by2));}},_polyLineHitTest:function(_bd,_be,_bf,_c0,_c1){var eps=this._edgeTestSensitivity;var hit=false;var _c2=_bd.getIterator();var _c3=_c2.get();while(_c3){var _c4=_c3.value;if(this._polyLineContains(_c4.p,_be,_bf,eps)){_c1.push(_c4);if(_c0){return true;}else{hit=true;}}_c3=_c2.get();}return hit;},_polyLineOverlapTest:function(_c5,x1,y1,x2,y2,_c6){var _c7=_c5.getIterator();var _c8=_c7.get();while(_c8){var _c9=_c8.value;if(this._controlPointsIn(_c9.p,x1,y1,x2,y2)||this._intersects(_c9.p,x1,y1,x2,y2)){_c6.push(_c9);}_c8=_c7.get();}},_polyLineContains:function(_ca,_cb,_cc,_cd){var x1=_ca[0].x;var y1=_ca[0].y;var x2,y2;for(var i=1;i<_ca.length;i++){x2=_ca[i].x;y2=_ca[i].y;if(this._lineContains(x1,y1,x2,y2,_cb,_cc,_cd)){return true;}x1=x2;y1=y2;}return false;},_controlPointsIn:function(pts,x1,y1,x2,y2){for(var i=0;i<pts.length;i++){if(x1<=pts[i].x&&x2>=pts[i].x&&y1<=pts[i].y&&y2>=pts[i].y){return true;}}return false;},_intersects:function(pts,x1,y1,x2,y2){for(var i=1;i<pts.length;i++){var p0=pts[i-1];var p1=pts[i];if(this._lineSegmentIntersection(p0.x,p0.y,p1.x,p1.y,x1,y1,x2,y1)||this._lineSegmentIntersection(p0.x,p0.y,p1.x,p1.y,x2,y1,x2,y2)||this._lineSegmentIntersection(p0.x,p0.y,p1.x,p1.y,x1,y2,x2,y2)||this._lineSegmentIntersection(p0.x,p0.y,p1.x,p1.y,x1,y1,x1,y2)){return true;}}return false;},_lineContains:function(x1,y1,x2,y2,_ce,_cf,_d0){if(_ce+_d0<Math.min(x1,x2)||_cf+_d0<Math.min(y1,y2)||_ce-_d0>Math.max(x1,x2)||_cf-_d0>Math.max(y1,y2)){return false;}var tdx=_ce-x1;var tdy=_cf-y1;var _d1=_d0*_d0;var _d2=tdx*tdx+tdy*tdy;if(_d2<_d1){return true;}var _d3=_ce-x2;var _d4=_cf-y2;var _d5=_d3*_d3+_d4*_d4;if(_d5<_d1){return true;}var dx=x2-x1;var dy=y2-y1;var l=Math.sqrt(dx*dx+dy*dy);if(l==0){return false;}var s=(dx*tdx+dy*tdy)/l;if(s<-_d0||s>l+_d0){return false;}var d2=_d2-s*s;return d2<_d1;}});yfiles.client.tiles.HitTest.getElementType=function(_d6){if(!_d6){return null;}var _d7="";if(dojo.isString(_d6)){var idx=_d6.indexOf("-");if(idx>0){_d7=_d6.substring(0,idx);}}else{if(_d6.firstHit){_d7=_d6.firstHit.t;}}switch(_d7){case "n":return "Node";case "nl":return "NodeLabel";case "e":return "Edge";case "el":return "EdgeLabel";}return "Paper";};yfiles.client.tiles.HitTest.getHitId=function(_d8){if(_d8&&_d8.firstHit){return _d8.firstHit.i;}else{return null;}};yfiles.client.tiles.HitTest.getHitIds=function(_d9){var res=[];if(_d9){var _da=["nodes","edges","nodeLabels","edgeLabels"];for(var i=0;i<_da.length;i++){var _db=_d9[_da[i]];for(var j=0;j<_db.length;j++){res.push(_db[j].i);}}}return res;};yfiles.client.tiles.HitTest.getBounds=function(_dc){if(!_dc||!_dc.firstHit){return null;}if(_dc.t!="e"){return this._getRectBounds(_dc.firstHit);}else{return this._getEdgeBounds(_dc.firstHit);}};yfiles.client.tiles.HitTest.getHitCount=function(_dd){if(!_dd){return 0;}var _de=0;var _df=[_dd.nodes,_dd.edges,_dd.nodeLabels,_dd.edgeLabels];for(var i=0;i<_df.length;i++){var _e0=_df[i];_de+=_e0.length;}return _de;};yfiles.client.tiles.HitTest.getUrl=function(_e1){if(_e1&&_e1.firstHit&&_e1.firstHit.u){return _e1.firstHit.u;}else{return null;}};yfiles.client.tiles.HitTest.getDescription=function(_e2){if(_e2&&_e2.firstHit&&_e2.firstHit.d){return _e2.firstHit.d;}else{return null;}};yfiles.client.tiles.HitTest.setCoords=function(_e3,x,y){_e3.x=x;_e3.y=y;};yfiles.client.tiles.HitTest._getRectBounds=function(_e4){return new yfiles.client.tiles.GraphBounds(_e4.x,_e4.x+_e4.w,_e4.y,_e4.y+_e4.h);};yfiles.client.tiles.HitTest._getEdgeBounds=function(_e5){var pts=_e5.p;var p0=pts[0];var res=new yfiles.client.tiles.GraphBounds(p0.x,p0.x,p0.y,p0.y);for(var i=1;i<pts.length;i++){res=res.union(new yfiles.client.tiles.GraphBounds(pts[i].x,pts[i].x,pts[i].y,pts[i].y));}return res;};}if(!dojo._hasResource["yfiles.client.tiles.GraphHighlighter"]){dojo._hasResource["yfiles.client.tiles.GraphHighlighter"]=true;dojo.provide("yfiles.client.tiles.GraphHighlighter");dojo.declare("yfiles.client.tiles.GraphHighlighter",null,{constructor:function(){},drawNodeHighlight:function(_e6,_e7,_e8){dojo.style(_e7,"opacity",0.3);dojo.style(_e7,"display","block");dojo.style(_e7,"position","absolute");dojo.addClass(_e7,"yFilesGraphCanvasOverlay");},drawEdgeHighlight:function(_e9,_ea,_eb,_ec){var pt=_ec[_eb];var _ed=dojo.doc.createElement("div");dojo.style(_ed,"left",(pt.x*_e9.zoom-5)+"px");dojo.style(_ed,"top",(pt.y*_e9.zoom-5)+"px");dojo.style(_ed,"width","10px");dojo.style(_ed,"height","10px");dojo.style(_ed,"opacity",0.7);dojo.style(_ed,"display","block");dojo.style(_ed,"position","absolute");dojo.addClass(_ed,"yFilesGraphCanvasOverlay");_ea.appendChild(_ed);if(_eb>0){var _ee=_ec[_eb-1];_ed=dojo.doc.createElement("div");var x=(pt.x+_ee.x)/2;var y=(pt.y+_ee.y)/2;dojo.style(_ed,"left",(x*_e9.zoom-5)+"px");dojo.style(_ed,"top",(y*_e9.zoom-5)+"px");dojo.style(_ed,"width","10px");dojo.style(_ed,"height","10px");dojo.style(_ed,"opacity",0.7);dojo.style(_ed,"display","block");dojo.style(_ed,"position","absolute");dojo.addClass(_ed,"yFilesGraphCanvasOverlay");_ea.appendChild(_ed);}}});}if(!dojo._hasResource["yfiles.client.tiles.widget.GraphCanvas"]){dojo._hasResource["yfiles.client.tiles.widget.GraphCanvas"]=true;dojo.provide("yfiles.client.tiles.widget.GraphCanvas");dojo.declare("yfiles.client.tiles.widget.GraphCanvas",[dijit._Widget,dijit._Templated],{width:512,height:512,x:0,y:0,tileSize:512,zoom:1,nodeEvents:false,edgeEvents:false,nodeLabelEvents:false,edgeLabelEvents:false,paperEvents:false,baseURL:".",path:"",highlightNodeSurroundPixels:10,mouseWheelScrollFactor:2,maxZoomForFitContent:1000000,movables:null,tilesFrame:null,tiles:null,oldTiles:null,overlays:null,_loading:null,_graph:null,_hitTest:null,_lastHit:null,_mover:null,_dragging:false,_moverConnectHandle:null,_mouseOver:false,_fixed:false,_worldBounds:null,_inputMode:"pan",_sequenceId:0,_mouse:null,_mouseDownPos:null,_worldCoords:null,_zoomDigits:4,_highlightMap:null,_requestedTiles:null,_recalculateTriggered:false,_updateViepointTriggered:false,_minZoomProvider:null,_maxZoomProvider:null,_highlighter:null,templateString:"<div class=\"yFilesGraphCanvas\" dojoAttachPoint=\"tilesFrame\" style=\"overflow:hidden;position:relative;width:100%;height:100%;bottom:auto;right:auto;\"\n     dojoAttachEvent=\"onmousedown:_onMouseDown,onmousemove:_onMouseMove,onmouseout:onMouseOut,onmouseover:onMouseOver,onmouseup:onMouseUp,onclick:onClick,ondblclick:onDblClick\">\n  <div class=\"loading\" dojoAttachPoint=\"_loading\" style=\"position:absolute;width: 100%;height:100%;z-index:0;\"></div>\n  <div class=\"movables\" dojoAttachPoint=\"movables\" style=\"border-width:0;padding:0;margin:0;position:absolute;\">\n    <div class=\"oldTiles\" dojoAttachPoint=\"oldTiles\" style=\"position:absolute;z-index:0;\"></div>\n    <div class=\"tiles\" dojoAttachPoint=\"tiles\" style=\"position:absolute;z-index:1;\"></div>\n    <div class=\"overlays\" dojoAttachPoint=\"overlays\" style=\"position:absolute;z-index:2;\"></div>\n  </div>\n  <div class=\"contents\" dojoAttachPoint=\"containerNode\" style=\"position:absolute;z-index:3;\"></div>\n</div>\n",postCreate:function(){dojo.connect(this.movables,"ondragstart",dojo,"stopEvent");dojo.connect(this.movables,"onselectstart",dojo,"stopEvent");this.setZoomBoundsProviders(null,null);this.setAutoRefresh(true);this._highlightMap=new dojox.collections.Dictionary();this._mouse={x:0,y:0};this._mouseDownPos={x:-100,y:-100};this._sequenceId=this._newSequenceId();try{this.tileSize=parseInt(this.tileSize);}catch(e){this.tileSize=512;}this._graph=new yfiles.client.tiles.Graph(this.baseURL);this._initializeGraphListeners();this._checkSize();this._requestedTiles={};this._hitTest=new yfiles.client.tiles.HitTest(this.baseURL,this.path,this._worldBounds,this.nodeEvents,this.edgeEvents,this.nodeLabelEvents,this.edgeLabelEvents,this.paperEvents);this._lastHit=this._hitTest.getEmptyHitInfo(0,0);this.connect(this._hitTest,"onNewData","_newHitTestData");if(dojo.isFF){this.tilesFrame.addEventListener("DOMMouseScroll",dojo.hitch(this,"_mouseWheeled"),false);}else{this.connect(this.tilesFrame,"onmousewheel","_mouseWheeled");}this._highlighter=new yfiles.client.tiles.GraphHighlighter(this);this.connect(window,"onresized","_onResized");this.setPath(this.path);},_removeMover:function(){this.disconnect(this._moverConnectHandle);this._moverConnectHandle=null;if(this._mover){this._mover.destroy();this._mover=null;}},setHighlighter:function(_ef){this._highlighter=_ef;},setBaseURL:function(_f0){this.baseURL=_f0;this._graph._baseURL=_f0;},setPath:function(_f1,_f2){if(!_f1||_f1==""){return;}this.clear();this.path=_f1;this.beforeRequest();this._graph.load(_f1,_f2);},getGraph:function(){return this._graph;},fitContent:function(){this._fitContent(false);},_fitContent:function(_f3){this.beforeRequest();var _f4=this;dojo.xhrGet({url:this.baseURL+"/getWorldBounds?path="+this.path+"&seq="+this._sequenceId,load:function(_f5,_f6){_f4.requestDone(true);if(_f3){_f4._removeDOMChildren(_f4.oldTiles);}_f4._initializeWorldBounds(_f5,_f3,true);_f4._refreshOverlays();_f4.viewPortChanged(_f4.x,_f4.y,_f4.width,_f4.height,_f4.zoom);if(_f3){_f4.unhighlightAll();}_f4.recalculateTiles(true);if(_f3){var _f7=function(url,_f8,_f9){_f4.pathSet(_f8);};_f4._hitTest.setGraphParameters(_f4.baseURL,_f4.path,_f4._worldBounds,_f7);}},error:function(_fa,_fb){_f4.requestDone(false);},handleAs:"json"});},clear:function(_fc){this._removeTiles();if(_fc!=false){if(this._hitTest){this._hitTest.clear();}this._highlightMap.clear();this._sequenceId=this._newSequenceId();}},refresh:function(_fd,_fe,_ff){if(!_ff){this.pushTiles();}this._sequenceId=this._newSequenceId();if(_fd){this.updateWorldBounds(_fd);}else{this.beforeRequest();var self=this;dojo.xhrGet({url:this.baseURL+"/getWorldBounds?path="+this.path+"&seq="+this._sequenceId,load:function(_100,_101){self.requestDone(true);var bb={minX:_100.x,minY:_100.y,maxX:_100.x+_100.width,maxY:_100.y+_100.height};self.updateWorldBounds(bb);},error:function(_102,_103){self.requestDone(false);},handleAs:"json"});}if(_fe){this.shift(this.zoom*_fe.x,this.zoom*_fe.y,true);}this.recalculateTiles(true);},_initializeWorldBounds:function(_104,_105,_106){if(this.height==0){this.height=this.tileSize;}if(this.width==0){this.width=this.tileSize;}this._worldBounds=new yfiles.client.tiles.GraphBounds(_104.x,_104.x+_104.width,_104.y,_104.y+_104.height);if(_106){var _107=this._getFullZoom()*0.95;var _108=Math.min(_107,this.maxZoomForFitContent);_108=this._round(_108);this.setZoom(_108,false);this.center(this.zoom*(_104.width/2+_104.x),this.zoom*(_104.height/2+_104.y));}},_getFullZoom:function(){var _109=this.width/this._worldBounds.width();var _10a=this.height/this._worldBounds.height();return Math.min(_109,_10a);},_round:function(x){var _10b=Math.pow(10,this._zoomDigits);var aux=Math.floor(_10b*x);return aux/_10b;},setZoom:function(zoom){this._setZoom(zoom,true);},setZoomBoundsProviders:function(_10c,_10d){if(_10c){this._minZoomProvider=_10c;}else{this._minZoomProvider=this._defaultMinZoomProvider;}if(_10d){this._maxZoomProvider=_10d;}else{this._maxZoomProvider=this._defaultMaxZoomProvider;}},_defaultMinZoomProvider:function(_10e){return 0.5*_10e._getFullZoom();},_defaultMaxZoomProvider:function(_10f){return 5;},_setZoom:function(zoom,_110){var _111=this._round(zoom);var _112=this._minZoomProvider(this);if(_111<_112){_111=this._round(_112);}var _113=this._maxZoomProvider(this);if(_111>_113){_111=this._round(_113);}if((_111>0)&&_110){this._zoomChanged(_111);}},setPanMode:function(_114){this._inputMode="pan";if(this._fixed){this._fixed=false;this.recalculateTiles(_114);}else{if(_114){this.recalculateTiles(_114);}}},setViewPoint:function(newX,newY,_115){this.x=Math.round(newX);this.y=Math.round(newY);if(!this._dragging){if(_115){var oldX=parseInt(this.movables.style.left);var oldY=parseInt(this.movables.style.top);this.oldTiles.style.left=(oldX-newX)+"px";this.oldTiles.style.top=(oldY-newY)+"px";}this.movables.style.left=this.x+"px";this.movables.style.top=this.y+"px";}if(this._mouseOver&&!this._dragging&&this._inputMode=="pan"&&this._hitTest){this._mouseOverOutTest();}this._refreshOverlays();this.viewPortChanged(this.x,this.y,this.width,this.height,this.zoom);},center:function(cX,cY){this.setViewPoint(-cX+this.width/2,-cY+this.height/2);},shift:function(dx,dy,_116){this.setViewPoint(this.x+dx,this.y+dy,_116);},setNoInteractionMode:function(){this._inputMode="none";if(!this._fixed){this._fixed=true;this._removeMover();this._removeTiles();this.recalculateTiles();}},fix:function(){if(this._inputMode=="pan"){this._fixed=true;this._removeMover();}},release:function(){if(this._inputMode=="pan"){this._fixed=false;}},_zoomChanged:function(zoom){if(this.path==""){return;}var _117=this.zoom;if(_117==zoom){return;}this.zoom=zoom;var _118={"x":Math.floor(this.width/2),"y":Math.floor(this.height/2)};var _119={"x":_118.x-this.x,"y":_118.y-this.y};var _11a=this.zoom/_117;var _11b={"x":Math.floor(_119.x*_11a),"y":Math.floor(_119.y*_11a)};dojo.forEach(this.tiles.childNodes,function(t){dojo.style(t,"display","none");});this.setViewPoint(_118.x-_11b.x,_118.y-_11b.y);if(!this._recalculateTriggered){var old=[];dojo.forEach(this.oldTiles.childNodes,function(t){old.push(t);});this._shiftOldTiles();this._scaleTiles(this.oldTiles,_11a);while(this.tiles.hasChildNodes()){var tile=this.tiles.firstChild;var img=tile.firstChild;if(img){this._scaleTile(tile,img,_11a);this.tiles.removeChild(tile);tile.removeAttribute("id");this.oldTiles.appendChild(tile);dojo.style(tile,"display","block");}else{dojo._destroyElement(tile);}}setTimeout(dojo.hitch(this,this._removeOldTiles,old),3000);}else{this._scaleTiles(this.oldTiles,_11a);}this._resetRequestedTile();this.recalculateTiles();},_shiftOldTiles:function(){var _11c=parseInt(this.oldTiles.style.left);var _11d=parseInt(this.oldTiles.style.top);if(_11c!=0||_11d!=0){dojo.style(this.oldTiles,"left","0px");dojo.style(this.oldTiles,"top","0px");dojo.forEach(this.oldTiles.childNodes,function(t){this._shiftTile(t,_11c,_11d);},this);}},_shiftTile:function(tile,dx,dy){var _11e=parseInt(tile.style.left);var _11f=parseInt(tile.style.top);dojo.style(tile,"left",(_11e+dx)+"px");dojo.style(tile,"top",(_11f+dy)+"px");},_scaleTiles:function(_120,_121){dojo.forEach(_120.childNodes,function(tile){if(tile){dojo.style(tile,"display","none");}});dojo.forEach(_120.childNodes,function(tile){if(tile){var img=tile.firstChild;if(img){this._scaleTile(tile,img,_121);dojo.style(tile,"display","block");}else{dojo._destroyElement(tile);}}},this);},_scaleTile:function(tile,img,_122){dojo.style(tile,"left",(parseInt(tile.style.left)*_122)+"px");dojo.style(tile,"top",(parseInt(tile.style.top)*_122)+"px");dojo.style(tile,"width",(parseInt(tile.style.width)*_122)+"px");dojo.style(tile,"height",(parseInt(tile.style.height)*_122)+"px");img.width=img.width*_122;img.height=img.height*_122;},_removeOldTiles:function(_123){var _124=true;dojo.forEach(this.tiles.childNodes,function(t){if(!t.firstChild){_124=false;}});if(_124){this._removeDOMNodes(_123);}else{setTimeout(dojo.hitch(this,this._removeOldTiles,_123),3000);}},_refreshOverlays:function(){var _125=this._highlightMap.getIterator();for(var _126=_125.get();_126;_126=_125.get()){this._refreshHighlight(_126.key);}},_dragMoved:function(_127,_128){if(!this._dragging){this.tilesFrame.style.cursor="move";}this._dragging=true;if(!this._updateViepointTriggered){this._updateViepointTriggered=true;setTimeout(dojo.hitch(this,this._updateViewPoint,false),100);}this.recalculateTiles();},_updateViewPoint:function(){var x=parseInt(this.movables.style.left);var y=parseInt(this.movables.style.top);this.setViewPoint(x,y);this._updateViepointTriggered=false;},_mouseWheeled:function(evt){dojo.stopEvent(evt);if(this._inputMode=="none"){return;}var _129=0;if(dojo.isFF){_129=-evt.detail;}else{if(typeof evt.wheelDelta=="number"){_129=evt.wheelDelta;}}if(_129>0){this.setZoom(this.zoom*this.mouseWheelScrollFactor);}else{if(_129<0){this.setZoom(this.zoom/this.mouseWheelScrollFactor);}}},resize:function(_12a){dojo.marginBox(this.domNode,_12a);this._onResized();},_checkSize:function(){var cb=dojo.contentBox(this.domNode);this.width=cb.w;this.height=cb.h;},_resizePending:false,_onResized:function(e){this._checkSize();if(!this._resizePending){this._resizePending=true;setTimeout(dojo.hitch(this,this._onResizedCore),200);}},_onResizedCore:function(){if(this._inputMode=="none"){this.setPath(this.path);}else{this.recalculateTiles();this._refreshOverlays();this.viewPortChanged(this.x,this.y,this.width,this.height,this.zoom);}this._resizePending=false;},onMouseOver:function(evt){this._mouseOver=true;},onMouseOut:function(evt){this._mouseOver=false;},isMouseOver:function(){return this._mouseOver;},_onMouseDown:function(evt){this._mouseDownPos={x:this._mouse.x,y:this._mouse.y};this._mouseOver=true;if(this._inputMode!="none"){this._dragging=false;}if(!this._fixed){this._mover=new dojo.dnd.Mover(this.movables,evt,this);this._moverConnectHandle=this.connect(this._mover,"onMouseMove","_onMouseMove");}evt.preventDefault();this.onMouseDown(evt);},onMove:function(_12b,_12c){dojo.marginBox(_12b.node,_12c);this._dragMoved(_12b,_12c);},onFirstMove:function(){},onMouseDown:function(evt){},onClick:function(evt){if(this._inputMode!="none"&&this._hitTest&&this._hitTest.isActive()&&this._mouse.x==this._mouseDownPos.x&&this._mouse.y==this._mouseDownPos.y){this._fireGraphEvent(evt,"onClick",false);}},_getGraphEvent:function(_12d){return this._hitTest.getHitInfo(this._worldCoords.x,this._worldCoords.y,_12d);},_fireGraphEvent:function(evt,type,_12e){var info=this._getGraphEvent(_12e);this._fireEvent(info,type,evt);},_fireEvent:function(info,type,evt){var _12f=yfiles.client.tiles.HitTest.getElementType(info);var _130=type+_12f;var func=this[_130];if(func){if(_12f!="Paper"){var id=yfiles.client.tiles.HitTest.getHitId(info);func.call(this,id,info,evt);}else{func.call(this,info,evt);}}},onDblClick:function(evt){if(this._inputMode!="none"&&this._hitTest&&this._hitTest.isActive()){this._fireGraphEvent(evt,"onDblClick",false);}},_fixLayerCoords:function(evt){var _131=dojo.mixin({},evt);var _132=dojo.coords(this.domNode,false);_131.layerX=evt.pageX-_132.x;_131.layerY=evt.pageY-_132.y;return _131;},_onMouseMove:function(evt){var _133=this._fixLayerCoords(evt);this._mouseOver=true;if(this._inputMode!="none"){this._mouse={x:_133.layerX,y:_133.layerY};if(this._hitTest&&this._hitTest.isActive()){if(!this._dragging){this._mouseOverOutTest(_133);}else{var _134=yfiles.client.tiles.HitTest.getHitId(this._lastHit);if(_134!=null){this._fireEvent(this._lastHit,"onMouseOut",evt);this._lastHit=this._hitTest.getEmptyHitInfo(this._worldCoords.x,this._worldCoords.y);}}}}evt.preventDefault();this.onMouseMove(_133);},onMouseMove:function(evt){},_mouseOverOutTest:function(evt){this._setWorldCoords();var info=this._getGraphEvent(true);var _135=yfiles.client.tiles.HitTest.getHitId(info);var _136=yfiles.client.tiles.HitTest.getHitId(this._lastHit);if(_135!=_136){if(_136!=null){yfiles.client.tiles.HitTest.setCoords(this._lastHit,this._worldCoords.x,this._worldCoords.y);this._fireEvent(this._lastHit,"onMouseOut",evt);}if(_135!=null){this._fireEvent(info,"onMouseOver",evt);}}this._lastHit=info;},_setWorldCoords:function(){this._worldCoords={x:(this._mouse.x-this.x)/this.zoom,y:(this._mouse.y-this.y)/this.zoom};},onMouseUp:function(evt){if(this._inputMode!="none"){this._dragging=false;this.tilesFrame.style.cursor="default";this._removeMover();if(this._inputMode=="pan"&&this._hitTest&&this._hitTest.isActive()){this._mouseOverOutTest();}}},onClickNode:function(_137,info,evt){},onDblClickNode:function(_138,info,evt){},onMouseOverNode:function(_139,info,evt){},onMouseOutNode:function(_13a,info,evt){},onClickNodeLabel:function(_13b,info,evt){},onDblClickNodeLabel:function(_13c,info,evt){},onMouseOverNodeLabel:function(_13d,info,evt){},onMouseOutNodeLabel:function(_13e,info,evt){},onClickEdge:function(_13f,info,evt){},onDblClickEdge:function(_140,info,evt){},onMouseOverEdge:function(_141,info,evt){},onMouseOutEdge:function(_142,info,evt){},onClickEdgeLabel:function(_143,info,evt){},onDblClickEdgeLabel:function(_144,info,evt){},onMouseOverEdgeLabel:function(_145,info,evt){},onMouseOutEdgeLabel:function(_146,info,evt){},onClickPaper:function(info,evt){},_assembleTileRequestString:function(_147){var req=this.baseURL+"/"+_147.request+"?zoom="+_147.zoom+"&col="+_147.col+"&row="+_147.row;if(_147.size){req+="&size="+_147.size;}else{req+="&size="+this.tileSize;}if(_147.path){req+="&path="+_147.path;}else{if(this.path){req+="&path="+this.path;}}req+="&seq="+this._sequenceId;return req;},_getTileId:function(zoom,col,row){return "div_"+this.id+"_"+zoom+"_"+col+"_"+row;},pushTiles:function(){var old=[];dojo.forEach(this.oldTiles.childNodes,function(t){old.push(t);});setTimeout(dojo.hitch(this,this._removeOldTiles,old),3000);this.oldTiles.style.left="0px";this.oldTiles.style.top="0px";while(this.tiles.hasChildNodes()){var tile=this.tiles.firstChild;this.tiles.removeChild(tile);tile.removeAttribute("id");this.oldTiles.appendChild(tile);}this._resetRequestedTile();},recalculateTiles:function(_148){if(this.path==""){return;}if(!this._recalculateTriggered){if(_148){this._sequenceId=this._newSequenceId();this._resetRequestedTile();}this._recalculateTriggered=true;setTimeout(dojo.hitch(this,this._recalculateTiles,_148),100);}},_recalculateTiles:function(_149){var _14a=new yfiles.client.tiles.GraphBounds(-this.x,this.width-this.x,-this.y,this.height-this.y);var _14b=this._columnsAndRowsForArea(_14a);this._loadTiles(_14b,_149);},_tileWasRequested:function(col,row){return (this._requestedTiles[col]&&this._requestedTiles[col][row]);},_registerTileRequest:function(col,row){if(!this._requestedTiles[col]){this._requestedTiles[col]={};}this._requestedTiles[col][row]=true;},_resetRequestedTile:function(col,row){if(col&&row){if(!this._requestedTiles[col]){this._requestedTiles[col]={};}this._requestedTiles[col][row]=false;}else{this._requestedTiles={};}},_loadTiles:function(_14c,_14d){dojo.style(this._loading,"display","block");for(var col=_14c.minX;col<=_14c.maxX;col++){for(var row=_14c.minY-1;row<=_14c.maxY+1;row++){var _14e=this._getTileId(this.zoom,col,row);if(_14d||!this._tileWasRequested(col,row)){this._registerTileRequest(col,row);this._loadTile(_14d,_14e,col,row);}}}this._hideLoading();this._recalculateTriggered=false;},_hideLoading:function(){var _14f=true;dojo.forEach(this.tiles.childNodes,function(t){if(!t.firstChild){_14f=false;}});if(_14f){dojo.style(this._loading,"display","none");}else{setTimeout(dojo.hitch(this,this._hideLoading),3000);}},_loadTile:function(_150,_151,col,row){if(!this._tileWasRequested(col,row)){return;}if(_150){var _152=dojo.byId(_151);if(_152){this._removeDOMChildren(_152);dojo._destroyElement(_152);}}var _153={request:"getImage",zoom:this.zoom,col:col,row:row};var _154=this._assembleTileRequestString(_153);var div=dojo.doc.createElement("div");div.setAttribute("id",_151);this.tiles.appendChild(div);dojo.style(div,"display","block");dojo.style(div,"position","absolute");dojo.style(div,"left",(col*this.tileSize)+"px");dojo.style(div,"top",(row*this.tileSize)+"px");dojo.style(div,"width",this.tileSize+"px");dojo.style(div,"height",this.tileSize+"px");setTimeout(dojo.hitch(this,this._loadImage,_154,div,_151),0);},_loadImage:function(_155,div,_156){var img=new Image(this.tileSize,this.tileSize);dojo.style(img,"display","block");var self=this;img.onload=function(){img.onload=null;if(div&&div.parentNode){div.appendChild(img);self.tileLoaded(self.path,_156);}};img.src=_155;},_removeTiles:function(){if(!this.tiles){return;}this._removeDOMChildren(this.tiles);this._resetRequestedTile();},_columnsAndRowsForArea:function(area){return area.scale(1/this.tileSize).round();},tileLoaded:function(_157){},pathSet:function(path){},viewPortChanged:function(x,y,_158,_159,zoom){},beforeRequest:function(){},requestDone:function(_15a){},getMousePosition:function(){return {x:this._mouse.x,y:this._mouse.y};},getViewCoordinates:function(rawX,rawY){rawX=rawX?rawX:this._mouse.x;rawY=rawY?rawY:this._mouse.y;var x=(rawX-this.x);var y=(rawY-this.y);return {x:x,y:y};},getWorldCoordinates:function(x,y){var _15b=this.getViewCoordinates(x,y);return {x:_15b.x/this.zoom,y:_15b.y/this.zoom};},getHitTest:function(){return this._hitTest;},getLastHitInfo:function(){return this._lastHit;},_newSequenceId:function(){return new dojox.uuid.Uuid(dojox.uuid.generateTimeBasedUuid());},_removeDOMChildren:function(_15c){while(_15c.hasChildNodes()){this._removeDOMChildren(_15c.firstChild);dojo._destroyElement(_15c.firstChild);}},_removeDOMNodes:function(_15d){dojo.forEach(_15d,function(_15e){this._removeDOMChildren(_15e);var _15f=_15e.parentNode;if(_15f){_15f.removeChild(_15e);}dojo._destroyElement(_15e);},this);},updateWorldBounds:function(_160,_161){if(this._worldBounds==null){this._initializeWorldBounds(_160);}else{this._worldBounds=new yfiles.client.tiles.GraphBounds(_160.minX,_160.maxX,_160.minY,_160.maxY);}if(this._hitTest&&!_161){this._hitTest.setGraphParameters(this.baseURL,this.path,this._worldBounds);}},_initializeGraphListeners:function(){this.connect(this._graph,"onLoad","_onLoad");this.connect(this._graph,"onLoadFailed","_onLoadFailed");this.connect(this._graph,"onNodeCreated","_onBoundsChange");this.connect(this._graph,"onEdgeCreated","_onBoundsChange");this.connect(this._graph,"onNodesMoved","_onBoundsChange");this.connect(this._graph,"onLabelSet","_onBoundsChange");this.connect(this._graph,"onRemove","_onBoundsChange");},_onLoad:function(name){this.requestDone(true);this._fitContent(true);},_onLoadFailed:function(name){this.requestDone(false);},isAutoRefresh:function(){return this._autoRefresh;},setAutoRefresh:function(_162){this._autoRefresh=_162;},_onBoundsChange:function(){if(this._autoRefresh){this.refresh();}},_newHitTestData:function(){this._refreshOverlays();if(!this._dragging&&this._inputMode=="pan"&&this._hitTest&&this._hitTest.isActive()){this._mouseOverOutTest();}},highlight:function(id){if(!this._highlightMap.item(id)){var div=this._createHighlightDiv(id);if(div){this.overlays.appendChild(div);this._highlightMap.add(id,div);}}},unhighlight:function(id){var div=this._highlightMap.item(id);if(div){this._removeDOMChildren(div);dojo._destroyElement(div);}this._highlightMap.remove(id);},unhighlightAll:function(){this._highlightMap.clear();this._removeDOMChildren(this.overlays);},_createHighlightDiv:function(id){var type=yfiles.client.tiles.HitTest.getElementType(id);if(type!="Edge"){return this._highlightRect(id);}else{return this._highlightEdge(id);}},_refreshHighlight:function(id){var div=this._highlightMap.item(id);if(div){this._removeDOMChildren(div);dojo._destroyElement(div);}div=this._createHighlightDiv(id);if(div){this.overlays.appendChild(div);}this._highlightMap.add(id,div);},_highlightRect:function(id){if(null!=this._highlighter){var _163=this._hitTest.getBoundsForId(id);if(_163){var div=dojo.doc.createElement("div");var sur=this.highlightNodeSurroundPixels;dojo.style(div,"left",(_163.minX*this.zoom-sur)+"px");dojo.style(div,"top",(_163.minY*this.zoom-sur)+"px");dojo.style(div,"width",(_163.width()*this.zoom+2*sur)+"px");dojo.style(div,"height",(_163.height()*this.zoom+2*sur)+"px");this._highlighter.drawNodeHighlight(this,div,_163);return div;}}return null;},_highlightEdge:function(id){if(null!=this._highlighter){var pts=this._hitTest.getControlPoints(id);if(pts!=null){var div=dojo.doc.createElement("div");for(var i=0;i<pts.length;i++){this._highlighter.drawEdgeHighlight(this,div,i,pts);}return div;}}return null;}});}if(!dojo._hasResource["yfiles.client.tiles.InputMode"]){dojo._hasResource["yfiles.client.tiles.InputMode"]=true;dojo.provide("yfiles.client.tiles.InputMode");dojo.declare("yfiles.client.tiles.InputMode",null,{_canvas:null,_hitTest:null,_active:false,_child:null,_oldCursor:null,_childDeactivateHandle:null,constructor:function(_164){this._active=false;this._child=null;this._canvas=_164;this._oldCursor=_164.domNode.style.cursor;this._hitTest=this._canvas.getHitTest();},isActive:function(){return this._active||(this._child&&this._child.isActive());},activate:function(){if(!this._active){if(this._child&&this._child.isActive()){this._child.deactivate();}else{this._child=null;this._active=true;this._attachEventListeners();}}},deactivate:function(){if(this._child){this._child.deactivate();}this._active=false;this._detachEventListeners();},getGraph:function(){return this._canvas.getGraph();},setCursor:function(_165,_166){if(!_166&&!this._oldCursor){this._oldCursor=this._canvas.domNode.style.cursor;}else{if(_166){this._oldCursor=_166;}}this._canvas.domNode.style.cursor=_165;},restoreCursor:function(){this._canvas.domNode.style.cursor=this._oldCursor;},setChild:function(_167){if(!this._active){return false;}this._child=_167;this._childDeactivateHandle=dojo.connect(this._child,"deactivate",this,"_reactivate");this._detachEventListeners();this._active=false;_167.activate();return true;},onReactivate:function(_168){},setEdgeTestSensitivity:function(_169){this._hitTest.setEdgeTestSensitivity(_169);},_attachEventListeners:function(){},_detachEventListeners:function(){},_reactivate:function(){dojo.disconnect(this._childDeactivateHandle);var _16a=this._child;this._child=null;this._active=true;this._attachEventListeners();this.onReactivate(_16a);}});}if(!dojo._hasResource["yfiles.client.tiles.widget.CanvasDragLine"]){dojo._hasResource["yfiles.client.tiles.widget.CanvasDragLine"]=true;dojo.provide("yfiles.client.tiles.widget.CanvasDragLine");dojo.declare("yfiles.client.tiles.widget.CanvasDragLine",[dijit._Widget,dijit._Templated],{templateString:"<div dojoAttachPoint=\"root\" class=\"canvasDragLineRoot\" style=\"overflow:hidden;width:100%;height:100%;\"></div>",root:null,canvas:null,_x1:0,_y1:0,_x2:0,_y2:0,_surface:null,_line:null,_mouseDownHandle:null,_dragLineHandle:null,_lineDoneHandle:null,activate:function(_16b){this.canvas=_16b;this._mouseDownHandle=this.connect(_16b,"onMouseDown","_onMouseDown");},activateAt:function(_16c,pos){this.canvas=_16c;this._onMouseDownAt(pos);},deactivate:function(){this._hideArea();},onLineChange:function(x1,y1,x2,y2){},onLineDone:function(x1,y1,x2,y2){},onDeactivated:function(){},_onMouseDown:function(evt){var _16d=this.canvas;this.disconnect(this._mouseDownHandle);var _16e={x:evt.pageX,y:evt.pageY};this._onMouseDownAt(_16e);},_onMouseDownAt:function(_16f){var _170=this.canvas;var _171=dojo.coords(this.root.parentNode,false);this._x1=_16f.x-_171.x;this._y1=_16f.y-_171.y;var _172=this.root;this._surface=dojox.gfx.createSurface(_172,_170.width,_170.height);this._line=this._surface.createLine({x1:this._x1,y1:this._y1,x2:this._x1+1,y2:this._y1+1});this._line.setStroke({color:"blue"});this._dragLineHandle=this.connect(_170,"onMouseMove","_dragLine");this._lineDoneHandle=this.connect(_170,"onMouseUp","_dragLineDone");},_dragLine:function(evt){var _173={x:evt.pageX,y:evt.pageY};var _174=dojo.coords(this.root.parentNode,false);this._x2=_173.x-_174.x;this._y2=_173.y-_174.y;this._line.setShape({x1:this._x1,y1:this._y1,x2:this._x2,y2:this._y2});this.onLineChange(this._x1,this._y1,this._x2,this._y2);},_dragLineDone:function(){var _175=this.canvas;var x1=this._x1-_175.x;var x2=this._x2-_175.x;var y1=this._y1-_175.y;var y2=this._y2-_175.y;this.onLineDone(x1,y1,x2,y2);this._hideArea();},_hideArea:function(){var _176=this.canvas;this.disconnect(this._mouseDownHandle);this.disconnect(this._dragLineHandle);this.disconnect(this._lineDoneHandle);if(this._surface){this._surface.remove(this._line,true);if(this._surface.clipNode){this.root.removeChild(this._surface.clipNode);}else{this.root.removeChild(this._surface.rawNode);}this._surface=null;}this.onDeactivated();}});}if(!dojo._hasResource["yfiles.client.tiles.CreateEdgeMode"]){dojo._hasResource["yfiles.client.tiles.CreateEdgeMode"]=true;dojo.provide("yfiles.client.tiles.CreateEdgeMode");dojo.declare("yfiles.client.tiles.CreateEdgeMode",yfiles.client.tiles.InputMode,{startNode:null,routeEdges:false,_dragLine:null,_endNode:null,constructor:function(_177,_178){if(_178){this.routeEdges=_178;}},activate:function(){this.inherited(arguments);if(!this.startNode||!this.acceptSourceNode(this.startNode)){this.cancelEdgeCreation();}else{this._startCreateEdge(this.startNode);}},deactivate:function(){this.startNode=null;this.setTargetNode(null);if(this._dragLine!=null){this._dragLine.deactivate();this._canvas.containerNode.removeChild(this._dragLine.domNode);this._dragLine=null;}this.inherited(arguments);},cancelEdgeCreation:function(){this.deactivate();},acceptSourceNode:function(_179){return (this.startNode!=null);},acceptTargetNode:function(_17a){return true;},setTargetNode:function(_17b){this._endNode=_17b;},createEdge:function(_17c,_17d,_17e){if(_17d&&_17e){_17c.createEdge(_17d,_17e,this.routeEdges);}},_attachEventListeners:function(){this._mouseOverHandle=dojo.connect(this._canvas,"onMouseOverNode",this,"_onMouseOverNode");this._mouseOutHandle=dojo.connect(this._canvas,"onMouseOutNode",this,"_onMouseOutNode");this._mouseOverLabelHandle=dojo.connect(this._canvas,"onMouseOverNodeLabel",this,"_onMouseOverNodeLabel");this._mouseOutLabelHandle=dojo.connect(this._canvas,"onMouseOutNodeLabel",this,"_onMouseOutNodeLabel");},_detachEventListeners:function(){dojo.disconnect(this._mouseOverHandle);dojo.disconnect(this._mouseOutHandle);dojo.disconnect(this._mouseOverLabelHandle);dojo.disconnect(this._mouseOutLabelHandle);dojo.disconnect(this._lineDoneHandle);},_onMouseOverNode:function(_17f){if(this.acceptTargetNode(_17f)){this.setTargetNode(_17f);}},_onMouseOutNode:function(_180){this.setTargetNode(null);},_onMouseOverNodeLabel:function(_181){var _182=this._canvas.getHitTest().getLabelInfo(_181);if(_182){var _183=_182.mainElementId;if(this.acceptTargetNode(_183)){this.setTargetNode(_183);}}},_onMouseOutNodeLabel:function(_184){this.setTargetNode(null);},_startCreateEdge:function(_185){var _186=this._canvas.getMousePosition();var _187=dojo.coords(this._canvas.domNode,false);_186.x+=_187.x;_186.y+=_187.y;if(this._dragLine==null){this._dragLine=new yfiles.client.tiles.widget.CanvasDragLine({canvas:this._canvas});this._canvas.containerNode.appendChild(this._dragLine.domNode);}this._dragLine.activateAt(this._canvas,_186);this._lineDoneHandle=dojo.connect(this._dragLine,"onLineDone",this,"_finishCreateEdge");},_finishCreateEdge:function(x1,y1,x2,y2){dojo.disconnect(this._lineDoneHandle);var _188=this._canvas;var _189=_188.getGraph();this.createEdge(_189,this.startNode,this._endNode);this.startNode=null;this.setTargetNode(null);this.deactivate();}});}if(!dojo._hasResource["yfiles.client.tiles.widget.PlaceableDialog"]){dojo._hasResource["yfiles.client.tiles.widget.PlaceableDialog"]=true;dojo.provide("yfiles.client.tiles.widget.PlaceableDialog");dojo.declare("yfiles.client.tiles.widget.PlaceableDialog",dijit.Dialog,{x:0,y:-100,_position:function(){var mb=dojo.marginBox(this.domNode);var _18a=dijit.getViewport();var _18b=this.x;var _18c=this.y;if(_18b+mb.width>_18a.w){_18b-=mb.width;}if(_18c<0){_18c=10;}with(this.domNode.style){left=_18b+"px";top=_18c+"px";}}});}if(!dojo._hasResource["yfiles.client.tiles.EditLabelMode"]){dojo._hasResource["yfiles.client.tiles.EditLabelMode"]=true;dojo.provide("yfiles.client.tiles.EditLabelMode");dojo.declare("yfiles.client.tiles.EditLabelMode",yfiles.client.tiles.InputMode,{_labelDialog:null,_labelText:null,_okButton:null,_cancelButton:null,nodeOrLabel:null,constructor:function(_18d){var div=dojo.doc.createElement("div");this._canvas.containerNode.appendChild(div);var inp=dojo.doc.createElement("input");inp.type="text";inp.name="label";inp.size=30;inp.maxsize=300;div.appendChild(inp);this._labelText=inp;var btn=dojo.doc.createElement("input");btn.type="button";btn.value="OK";div.appendChild(btn);this._okButton=btn;this._labelDialog=new yfiles.client.tiles.widget.PlaceableDialog({title:"Edit Label",duration:500},div);},activate:function(){this.inherited(arguments);if(this.nodeOrLabel){var type=yfiles.client.tiles.HitTest.getElementType(this.nodeOrLabel);if(type=="Node"||type=="NodeLabel"){this._editLabel();return;}}this.deactivate();},deactivate:function(){this.inherited(arguments);this._labelDialog.hide();},_attachEventListeners:function(){this._clickHandle=dojo.connect(this._okButton,"onclick",this,"_labelDone");this._hideHandle=dojo.connect(this._labelDialog,"hide",this,"deactivate");},_detachEventListeners:function(){dojo.disconnect(this._clickHandle);dojo.disconnect(this._hideHandle);},_editLabel:function(){var _18e=this._canvas.getGraph();_18e.getLabel(this.nodeOrLabel,this,this._openLabelEditor,this.deactivate);},_openLabelEditor:function(lbl){this._labelText.value=lbl;var _18f=this._canvas.getMousePosition();this._labelDialog.x=_18f.x;this._labelDialog.y=_18f.y-25;this._labelDialog.show();},_labelDone:function(){var _190=this._labelText.value;var _191=this._canvas;var _192=this._canvas.getGraph();_192.setLabel(this.nodeOrLabel,_190);this.deactivate();}});}if(!dojo._hasResource["yfiles.client.tiles.HierarchyManager"]){dojo._hasResource["yfiles.client.tiles.HierarchyManager"]=true;dojo.provide("yfiles.client.tiles.HierarchyManager");dojo.declare("yfiles.client.tiles.HierarchyManager",null,{_graph:null,_type:null,_parent:null,_stateLabelBounds:null,_visibleGraphParent:null,constructor:function(_193){this._graph=_193;this._type=new Object();this._parent=new Object();this._stateLabelBounds=new Object();dojo.connect(_193,"onLoad",this,"refresh");dojo.connect(_193,"onRemove",this,"refresh");dojo.connect(_193,"onNodesMoved",this,"refresh");dojo.connect(_193,"onNodeCreated",this,"_onNewNode");this.refresh();},refresh:function(){if(this._graph){var name=this._graph.getName();if(name&&name.length>0){var _194={path:name};var self=this;dojo.xhrGet({url:this._graph.getBaseURL()+"/getHierarchyInfo",content:_194,load:function(info,_195){self._initializeHierarchyInfo(info,name);},preventCache:true,handleAs:"json"});}else{this._clearHierarchyInfo();this.onNewHierarchyInfo(name);}}},setData:function(_196){this._initializeHierarchyInfo(_196,this.getGraph().getName());},_initializeHierarchyInfo:function(info,name){this._clearHierarchyInfo();for(var i=0;i<info.length;i++){var _197=info[i];var id=_197["i"];this._type[id]=_197["t"];this._parent[id]=_197["p"];this._stateLabelBounds[id]=_197["s"];}this.onNewHierarchyInfo(name);},_clearHierarchyInfo:function(){delete this._type;this._type=new Object();delete this._parent;this._parent=new Object();delete this._stateLabelBounds;this._stateLabelBounds=new Object();},_onNewNode:function(id){this._type[id]=0;this._parent[id]=this._visibleGraphParent;},getGraph:function(){return this._graph;},getNodes:function(args){var _198=new Array();var _199={excludeNormalNodes:false,excludeFolderNodes:false,excludeGroupNodes:false};var _19a=dojo.delegate(_199,args);for(var idx in this._type){var type=this._type[idx];if((type==0&&!_19a.excludeNormalNodes)||(type==1&&!_19a.excludeGroupNodes)||(type==2&&!_19a.excludeFolderNodes)){if(!_19a.onlyChildrenOf||_19a.onlyChildrenOf==this._parent[idx]){_198.push(idx);}}}return _198;},getVisibleGraphParent:function(){return this._visibleGraphParent;},isNormalNode:function(_19b){return this._type[_19b]==0;},isGroupNode:function(_19c){return this._type[_19c]==1;},isFolderNode:function(_19d){return this._type[_19d]==2;},getParent:function(_19e){return this._parent[_19e];},isInStateLabelBox:function(_19f,x,y){var box=this._stateLabelBounds[_19f];return box&&box.x<=x&&box.y<=y&&x<=box.x+box.w&&y<=box.y+box.h;},createGroup:function(args){var name=this._graph.getName();if(name){var _1a0=dojo.clone(args);if(_1a0.subNodeIds){_1a0.subNodeIds=this._createIdsString(_1a0.subNodeIds);}var _1a1=args.customData;var _1a2={name:name,x:0,y:0};var _1a3=dojo.delegate(_1a2,_1a0);var self=this;dojo.xhrPost({url:this._graph.getBaseURL()+"/createGroup",content:_1a3,load:function(data,_1a4){self._initializeHierarchyInfo(data.hinfo,name);self.onCreateGroup(data.id,data.bounds,name,_1a1);},error:function(_1a5,_1a6){self.onCreateGroupFailed(name,_1a1);},handleAs:"json"});}else{this.onCreateGroupFailed(null,_1a1);}},moveToSubgraph:function(_1a7,_1a8,_1a9){var name=this._graph.getName();if(name){var _1aa=this._createIdsString(_1a7);var _1ab={name:name,subNodeIds:_1aa};if(_1a8){_1ab.parentNodeId=_1a8;}var self=this;dojo.xhrPost({url:this._graph.getBaseURL()+"/moveToSubgraph",content:_1ab,load:function(data,_1ac){self._initializeHierarchyInfo(data.hinfo,name);self.onMoveToSubgraph(data.id,data.bounds,_1a7,_1a9);},error:function(_1ad,_1ae){self.onMoveToSubgraphFailed(name,_1a8,_1a7,_1a9);},handleAs:"json"});}else{this.onMoveToSubgraphFailed(null,_1a8,_1a7,_1a9);}},_createIdsString:function(ids){var _1af="";dojo.forEach(ids,function(id){_1af+=id+",";});if(_1af.length>0){_1af=_1af.substring(0,_1af.length-1);}return _1af;},moveToParent:function(_1b0,_1b1){var name=this._graph.getName();if(name){var _1b2=this._createIdsString(_1b0);var _1b3={name:name,subNodeIds:_1b2};var self=this;dojo.xhrPost({url:this._graph.getBaseURL()+"/moveToParent",content:_1b3,load:function(data,_1b4){self._initializeHierarchyInfo(data.hinfo,name);self.onMoveToParent(data.id,data.bounds,_1b0,_1b1);},error:function(_1b5,_1b6){self.onMoveToParentFailed(name,_1b0,_1b1);},handleAs:"json"});}else{this.onMoveToParentFailed(null,_1b0,_1b1);}},closeGroup:function(_1b7,_1b8){var name=this._graph.getName();if(name){var _1b9={name:name,id:_1b7};var self=this;dojo.xhrPost({url:this._graph.getBaseURL()+"/closeGroup",content:_1b9,load:function(data,_1ba){self._initializeHierarchyInfo(data.hinfo,name);self.onCloseGroup(_1b7,data.bounds,_1b8);},error:function(_1bb,_1bc){self.onCloseGroupFailed(name,_1b7,_1b8);},handleAs:"json"});}else{this.onCloseGroupFailed(null,_1b7,_1b8);}},openGroup:function(_1bd,_1be){var name=this._graph.getName();var _1bf={name:name,id:_1bd};if(name){var self=this;dojo.xhrPost({url:this._graph.getBaseURL()+"/openGroup",content:_1bf,load:function(data,_1c0){self._initializeHierarchyInfo(data.hinfo,name);self.onOpenGroup(_1bd,data.bounds,_1be);},error:function(_1c1,_1c2){self.onOpenGroupFailed(name,_1bd,_1be);},handleAs:"json"});}else{this.onOpenGroupFailed(null,_1bd,_1be);}},switchToSubgraph:function(_1c3,_1c4){var name=this._graph.getName();var _1c5={name:name,id:_1c3};if(name){var self=this;dojo.xhrPost({url:this._graph.getBaseURL()+"/switchToSubgraph",content:_1c5,load:function(data,_1c6){self._visibleGraphParent=data.id;self._initializeHierarchyInfo(data.hinfo,name);self.onSwitchToSubgraph(data.id,data.bounds,_1c4);},error:function(_1c7,_1c8){self.onSwitchToSubgraphFailed(name,_1c3,_1c4);},handleAs:"json"});}else{this.onSwitchToSubgraphFailed(null,_1c3,_1c4);}},switchToParent:function(_1c9){var _1ca={name:this._graph.getName()};if(this._graph.getName()){var self=this;dojo.xhrPost({url:this._graph.getBaseURL()+"/switchToParent",content:_1ca,load:function(data,_1cb){self._visibleGraphParent=data.id;self._initializeHierarchyInfo(data.hinfo,name);self.onSwitchToParent(data.id,data.bounds,_1c9);},error:function(_1cc,_1cd){self.onSwitchToParentFailed(self._graph.getName(),_1c9);},handleAs:"json"});}else{this.onSwitchToParentFailed(null,_1c9);}},onNewHierarchyInfo:function(name){},onCreateGroup:function(id,_1ce,name,_1cf){},onCreateGroupFailed:function(name,_1d0){},onCloseGroup:function(id,_1d1,_1d2){},onOpenGroup:function(id,_1d3,_1d4){},onCloseGroupFailed:function(name,id,_1d5){},onOpenGroupFailed:function(name,id,_1d6){},onSwitchToSubgraph:function(id,_1d7,_1d8){},onSwitchToSubgraphFailed:function(name,id,_1d9){},onSwitchToParent:function(id,_1da,_1db){},onSwitchToParentFailed:function(name,_1dc){},onMoveToSubgraph:function(_1dd,_1de,_1df,_1e0){},onMoveToSubgraphFailed:function(name,_1e1,_1e2,_1e3){},onMoveToParent:function(_1e4,_1e5,_1e6,_1e7){},onMoveToParentFailed:function(name,_1e8,_1e9){}});}if(!dojo._hasResource["yfiles.client.tiles.GroupNavigationMode"]){dojo._hasResource["yfiles.client.tiles.GroupNavigationMode"]=true;dojo.provide("yfiles.client.tiles.GroupNavigationMode");dojo.declare("yfiles.client.tiles.GroupNavigationMode",yfiles.client.tiles.InputMode,{_hierarchy:null,_connectHandles:null,_convertedOnSwitch:null,constructor:function(_1ea,_1eb){this._hierarchy=_1eb;this._connectHandles=[];this._convertedOnSwitch={};},activate:function(){this.inherited(arguments);},deactivate:function(){this.inherited(arguments);},_onClickNode:function(id,info,evt){if(evt.ctrlKey&&evt.shiftKey){if(!this._hierarchy.isNormalNode(id)){if(this._hierarchy.isGroupNode(id)){this._convertedOnSwitch[id]=true;}this._hierarchy.switchToSubgraph(id);}}else{this._updateGroupState(id,evt);}},_onClickNodeLabel:function(_1ec,info,evt){var _1ed=this._canvas.getHitTest().getLabelInfo(_1ec);if(_1ed){var _1ee=_1ed.mainElementId;this._updateGroupState(_1ee,evt);}},_onClickPaper:function(info,evt){if(evt.ctrlKey&&evt.shiftKey){this._switchedFromChild=this._hierarchy.getVisibleGraphParent();this._hierarchy.switchToParent();}},_refreshCanvas:function(id,_1ef){this._canvas.refresh(_1ef,null,true);if(this._switchedFromChild){this._canvas.fitContent();this._switchedFromChild=null;}},_refreshCanvasOnGroupSwitch:function(id,_1f0){this._refreshCanvas(id,_1f0);this._canvas.fitContent();},_onSwitchToParent:function(id,_1f1){if(this._switchedFromChild&&this._convertedOnSwitch[this._switchedFromChild]){this._hierarchy.openGroup(this._switchedFromChild);delete this._convertedOnSwitch[this._switchedFromChild];}else{this._switchedFromChild=null;this._refreshCanvasOnGroupSwitch(id,_1f1);}},_clear:function(){this._convertedOnSwitch={};},_attachEventListeners:function(){if(this._connectHandles.length!=0){return;}this._connectHandles=[dojo.connect(this._canvas,"onClickPaper",this,"_onClickPaper"),dojo.connect(this._canvas,"onClickNode",this,"_onClickNode"),dojo.connect(this._canvas,"onClickNodeLabel",this,"_onClickNodeLabel"),dojo.connect(this._canvas,"pathSet",this,"_clear"),dojo.connect(this._hierarchy,"onCloseGroup",this,"_refreshCanvas"),dojo.connect(this._hierarchy,"onOpenGroup",this,"_refreshCanvas"),dojo.connect(this._hierarchy,"onSwitchToSubgraph",this,"_refreshCanvasOnGroupSwitch"),dojo.connect(this._hierarchy,"onSwitchToParent",this,"_onSwitchToParent")];},_detachEventListeners:function(){dojo.forEach(this._connectHandles,dojo.disconnect);this._connectHandles=[];},_updateGroupState:function(_1f2,evt){if(!evt.ctrlKey&&!evt.shiftKey&&!evt.altKey){if(!this._hierarchy.isNormalNode(_1f2)){var pos=this._canvas.getWorldCoordinates();if(this._hierarchy.isInStateLabelBox(_1f2,pos.x,pos.y)){if(this._hierarchy.isGroupNode(_1f2)){this._canvas.pushTiles();this._hierarchy.closeGroup(_1f2);}else{if(this._hierarchy.isFolderNode(_1f2)){this._canvas.pushTiles();this._hierarchy.openGroup(_1f2);}}}}}}});}if(!dojo._hasResource["yfiles.client.tiles.GraphSelection"]){dojo._hasResource["yfiles.client.tiles.GraphSelection"]=true;dojo.provide("yfiles.client.tiles.GraphSelection");dojo.declare("yfiles.client.tiles.GraphSelection",null,{_nodes:null,_edges:null,_size:0,constructor:function(_1f3,_1f4){this.setSelectNodes(_1f3);this.setSelectEdges(_1f4);this._size=0;},setSelectNodes:function(bool){if(bool){if(!this._nodes){this._nodes={};}}else{this.removeAll(this.getNodes());this._nodes=null;}},setSelectEdges:function(bool){if(bool){if(!this._edges){this._edges={};}}else{this.removeAll(this.getEdges());this._edges=null;}},getSize:function(){return this._size;},getNodes:function(){var res=[];this._getElems(this._nodes,res);return res;},getEdges:function(){var res=[];this._getElems(this._edges,res);return res;},get:function(){var res=[];this._getElems(this._nodes,res);this._getElems(this._edges,res);return res;},add:function(id){switch(yfiles.client.tiles.HitTest.getElementType(id)){case "Node":if(this._nodes&&!this._nodes[id]){this._nodes[id]=true;this._size++;this.onAddNode(id);return true;}break;case "Edge":if(this._edges&&!this._edges[id]){this._edges[id]=true;this._size++;this.onAddEdge(id);return true;}break;}return false;},remove:function(id){switch(yfiles.client.tiles.HitTest.getElementType(id)){case "Node":if(this._nodes&&this._nodes[id]){delete this._nodes[id];this._size--;this.onRemoveNode(id);return true;}break;case "Edge":if(this._edges&&this._edges[id]){delete this._edges[id];this._size--;this.onRemoveEdge(id);return true;}break;}return false;},toggle:function(id){if(this.isSelected(id)){return this.remove(id);}else{return this.add(id);}},addAll:function(ids){for(var i=0;i<ids.length;i++){this.add(ids[i]);}},removeAll:function(ids){for(var i=0;i<ids.length;i++){this.remove(ids[i]);}},toggleAll:function(ids){for(var i=0;i<ids.length;i++){this.toggle(ids[i]);}},isSelected:function(id){if((this._nodes&&this._nodes[id])||(this._edges&&this._edges[id])){return true;}else{return false;}},clear:function(){this.removeAll(this.getEdges());this.removeAll(this.getNodes());},onAddNode:function(_1f5){},onAddEdge:function(_1f6){},onRemoveNode:function(_1f7){},onRemoveEdge:function(_1f8){},_getElems:function(coll,res){if(coll){for(var idx in coll){if(coll[idx]){res.push(idx);}}}}});}if(!dojo._hasResource["yfiles.client.tiles.MoveSelectionMode"]){dojo._hasResource["yfiles.client.tiles.MoveSelectionMode"]=true;dojo.provide("yfiles.client.tiles.MoveSelectionMode");dojo.declare("yfiles.client.tiles.MoveSelectionMode",yfiles.client.tiles.InputMode,{_selection:null,_startPosition:null,_div:null,_drag:null,_hierarchy:null,_MouseUpHandle:null,_MouseMoveHandle:null,_routeEdges:false,constructor:function(_1f9,_1fa,_1fb,_1fc){this._selection=_1fa;if(_1fb){this._hierarchy=_1fb;}if(_1fc){this._routeEdges=_1fc;}var _1fd=dojo.doc.createElement("div");_1fd.style.position="absolute";this._canvas.containerNode.appendChild(_1fd);this._div=_1fd;},activate:function(){this.inherited(arguments);if(this._selection.getNodes().length==0){this.deactivate();}else{this._startPosition=this._canvas.getMousePosition();this._showGhosts();}},deactivate:function(){this._hideGhosts();this.inherited(arguments);},setRouteEdges:function(_1fe){this._routeEdges=_1fe;},isRouteEdges:function(){return this._routeEdges;},_onMouseUp:function(evt){this._hideGhosts();this._moveNodesSwitchGroups(evt);this.deactivate();},_showGhosts:function(){this._div.style.left="0px";this._div.style.top="0px";var _1ff=this._selection.getNodes();for(var idx=0;idx<_1ff.length;idx++){var id=_1ff[idx];var _200=this._hitTest.getBoundsForId(id);var zoom=this._canvas.zoom;var div=dojo.doc.createElement("div");this._div.appendChild(div);div.style.position="absolute";div.style.cursor="move";var sur=this._canvas.highlightNodeSurroundPixels;dojo.style(div,"left",(this._canvas.x+_200.minX*zoom-sur)+"px");dojo.style(div,"top",(this._canvas.y+_200.minY*zoom-sur)+"px");dojo.style(div,"width",(_200.width()*zoom+2*sur)+"px");dojo.style(div,"height",(_200.height()*zoom+2*sur)+"px");div.style.backgroundColor="yellow";dojo.style(div,"opacity",0.5);}this._MouseUpHandle=dojo.connect(this._canvas,"onMouseUp",this,"_onMouseUp");this._MouseMoveHandle=dojo.connect(this._canvas,"onMouseMove",this,"_moveGhosts");},_moveGhosts:function(){var pos=this._canvas.getMousePosition();var x=pos.x-this._startPosition.x;var y=pos.y-this._startPosition.y;this._div.style.left=x+"px";this._div.style.top=y+"px";},_hideGhosts:function(){this._moving=false;if(this._div){dojo.disconnect(this._MouseUpHandle);dojo.disconnect(this._MouseMoveHandle);while(this._div.hasChildNodes()){this._div.removeChild(this._div.firstChild);}}},_moveNodesSwitchGroups:function(evt){if(this._hierarchy&&evt.shiftKey){this._switchGroups();}else{this._moveNodes(this._selection.getNodes());}},_switchGroups:function(){var _201=this._canvas;var _202=this._selection.getNodes();var _203=_201.getHitTest();var _204=_201.getWorldCoordinates();var info=_203.getHitInfo(_204.x,_204.y,false);var _205=yfiles.client.tiles.HitTest.getHitIds(info);var _206=dojo.hitch(this,this._moveNodes,_202);if(_205.length>0){for(var idx in _205){var id=_205[idx];if(!this._hierarchy.isNormalNode(id)){this._tmpMTSHandle=dojo.connect(this._hierarchy,"onMoveToSubgraph",this,_206);this._tmpMTSFHandle=dojo.connect(this._hierarchy,"onMoveToSubgraphFailed",this,_206);this._hierarchy.moveToSubgraph(_202,id);break;}}}else{this._tmpMTSHandle=dojo.connect(this._hierarchy,"onMoveToSubgraph",this,_206);this._tmpMTSFHandle=dojo.connect(this._hierarchy,"onMoveToSubgraphFailed",this,_206);this._hierarchy.moveToSubgraph(_202,this._hierarchy.getVisibleGraphParent());}},_moveNodes:function(_207){if(this._tmpMTSHandle){dojo.disconnect(this._tmpMTSHandle);delete this._tmpMTSHandle;}if(this._tmpMTSFHandle){dojo.disconnect(this._tmpMTSFHandle);delete this._tmpMTSFHandle;}var _208=this._canvas;var pos=_208.getMousePosition();var x=(pos.x-this._startPosition.x)/_208.zoom;var y=(pos.y-this._startPosition.y)/_208.zoom;_208.getGraph().moveNodes(_207,x,y,this._routeEdges);}});}if(!dojo._hasResource["yfiles.client.tiles.widget.Rubberband"]){dojo._hasResource["yfiles.client.tiles.widget.Rubberband"]=true;dojo.provide("yfiles.client.tiles.widget.Rubberband");dojo.declare("yfiles.client.tiles.widget.Rubberband",[dijit._Widget,dijit._Templated],{templateString:"<div dojoAttachPoint=\"root\" style=\"display:none;overflow:hidden;\"><div dojoAttachPoint=\"area\" class=\"yFilesRubberbandArea\" style=\"position:absolute;display:none;font-size:1px;\"></div></div>",fixCanvas:false,releaseCanvas:false,root:null,area:null,canvas:null,_mouseX:0,_mouseY:0,_initialX:0,_initialY:0,_resizeAreaHandle:null,_showAreaHandle:null,_mouseMoveHandle:null,activate:function(_209){this.canvas=_209;if(this.fixCanvas){this.canvas.fix();}this._showAreaHandle=this.connect(this.canvas,"onMouseDown","_showArea");},activateAt:function(_20a,pos){this.canvas=_20a;if(this.fixCanvas){this.canvas.fix();}this._showAreaAt(pos);},deactivate:function(){this._hideArea();this.onDeactivated();},onAreaResized:function(x,y,_20b,_20c){},onAreaDone:function(x,y,_20d,_20e){},onDeactivated:function(){},_showArea:function(){this.disconnect(this._showAreaHandle);var _20f=this.canvas.getMousePosition();this._showAreaAt(_20f);},_showAreaAt:function(pos){var x=pos.x;var y=pos.y;this._initialX=x;this._initialY=y;var area=this.area;area.style.width="1px";area.style.height="1px";area.style.left=this._initialX+"px";area.style.top=this._initialY+"px";dojo.style(area,"opacity",0.2);area.style.display="block";this.root.style.display="block";this._resizeAreaHandle=this.connect(this.canvas,"onMouseMove","_resizeArea");this._mouseMoveHandle=this.connect(this.canvas,"onMouseUp","_areaDone");},_resizeArea:function(evt){var pos=this.canvas.getMousePosition();this._mouseX=pos.x;this._mouseY=pos.y;var w=this._mouseX-this._initialX;var h=this._mouseY-this._initialY;var _210=this._initialX;var _211=this._initialY;var _212=w;var _213=h;var area=this.area;if(w>=0){area.style.width=_212+"px";}else{_210=this._initialX+w;_212=-w;area.style.left=_210+"px";area.style.width=_212+"px";}if(h>=0){area.style.height=_213+"px";}else{_211=this._initialY+h;_213=-h;area.style.top=_211+"px";area.style.height=_213+"px";}this.onAreaResized(_210,_211,_212,_213);},_areaDone:function(){var _214=this.canvas;var area=this.area;var x=parseInt(area.style.left)-_214.x;var y=parseInt(area.style.top)-_214.y;var w=parseInt(area.style.width);var h=parseInt(area.style.height);this._hideArea();this.onAreaDone(x,y,w,h);this.onDeactivated();},_hideArea:function(){if(this.releaseCanvas&&this.canvas){this.canvas.release();}this.disconnect(this._showAreaHandle);this.disconnect(this._mouseMoveHandle);this.disconnect(this._resizeAreaHandle);window.status="";var area=this.area;area.style.display="none";area.style.left="-10px";area.style.top="-10px";area.style.width="1px";area.style.height="1px";this.root.style.display="none";}});}if(!dojo._hasResource["yfiles.client.tiles.RectangularSelectionMode"]){dojo._hasResource["yfiles.client.tiles.RectangularSelectionMode"]=true;dojo.provide("yfiles.client.tiles.RectangularSelectionMode");dojo.declare("yfiles.client.tiles.RectangularSelectionMode",yfiles.client.tiles.InputMode,{_rubberBand:null,_selection:null,_hierarchy:null,_connectHandles:null,constructor:function(_215,_216,_217){this._selection=_216;this._rubberBand=new yfiles.client.tiles.widget.Rubberband({canvas:this._canvas,fixCanvas:true});this._canvas.containerNode.appendChild(this._rubberBand.domNode);this._connectHandles=[];this._hierarchy=_217;},activate:function(){this.inherited(arguments);window.status="Drag to mark the selection area.";this._rubberBand.activateAt(this._canvas,this._canvas.getMousePosition());},deactivate:function(){if(this.isActive()){this._rubberBand.deactivate();window.status="";}this.inherited(arguments);},_attachEventListeners:function(){if(this._connectHandles.length==0){this._connectHandles=[dojo.connect(this._rubberBand,"onDeactivated",this,"_hideSelectionArea"),dojo.connect(this._rubberBand,"onAreaDone",this,"_applySelectionArea"),dojo.connect(this._selection,"onAddNode",this._canvas,"highlight"),dojo.connect(this._selection,"onRemoveNode",this._canvas,"unhighlight"),dojo.connect(this._selection,"onAddEdge",this._canvas,"highlight"),dojo.connect(this._selection,"onRemoveEdge",this._canvas,"unhighlight"),dojo.connect(this._canvas.getGraph(),"onRemove",this._selection,"removeAll")];}},_detachEventListeners:function(){dojo.forEach(this._connectHandles,dojo.disconnect);this._connectHandles=[];},_applySelectionArea:function(x,y,w,h){var _218=this._canvas;var zoom=this._canvas.zoom;var minX=x/zoom;var minY=y/zoom;var maxX=(x+w)/zoom;var maxY=(y+h)/zoom;var info=this._hitTest.getOverlaps(minX,minY,maxX,maxY);var ids=yfiles.client.tiles.HitTest.getHitIds(info);if(this._hierarchy){var _219=[];for(var idx in ids){var id=ids[idx];if(this._hierarchy.isGroupNode(id)){var _21a=this._hitTest.getBoundsForId(id);if(minX<=_21a.minX&&minY<=_21a.minY&&_21a.maxX<=maxX&&_21a.maxY<=maxY){_219.push(id);}}else{_219.push(id);}}this._selection.addAll(_219);}else{this._selection.addAll(ids);}this.deactivate();},_hideSelectionArea:function(){window.status="";}});}if(!dojo._hasResource["yfiles.client.tiles.EditMode"]){dojo._hasResource["yfiles.client.tiles.EditMode"]=true;dojo.provide("yfiles.client.tiles.EditMode");dojo.declare("yfiles.client.tiles.EditMode",yfiles.client.tiles.InputMode,{nodeType:null,_hierarchy:null,_groupNavigationMode:null,_createEdgeMode:null,_moveSelectionMode:null,_rectangularSelectionMode:null,_editLabelMode:null,_currentNode:null,_selection:null,_selectNodes:false,_selectEdges:false,_mouseDown:false,_edgeTestSensitivity:5,_groupBorderWidth:5,_connectHandles:null,_allowEdgeCreation:true,_allowNodeCreation:true,_allowMoveSelection:true,_allowLabelEditing:true,_allowElementRemoval:true,constructor:function(_21b,_21c,_21d,_21e,_21f){this._selectNodes=_21c;this._selectEdges=_21d;if(_21c||_21d){this._selection=new yfiles.client.tiles.GraphSelection(_21c,_21d);}if(_21f){this._hierarchy=_21f;this._groupNavigationMode=this.createGroupNavigationMode(_21b,_21f);this._groupNavigationMode.activate();}this._createEdgeMode=this.createCreateEdgeMode(_21b,_21e);this._moveSelectionMode=this.createMoveSelectionMode(_21b,this._selection,_21f);this._rectangularSelectionMode=this.createRectangularSelectionMode(_21b,this._selection,_21f);this._editLabelMode=this.createEditLabelMode(_21b);this._connectHandles=[];},createGroupNavigationMode:function(_220,_221){return new yfiles.client.tiles.GroupNavigationMode(_220,_221);},createCreateEdgeMode:function(_222,_223){return new yfiles.client.tiles.CreateEdgeMode(_222,_223);},createMoveSelectionMode:function(_224,_225,_226){return new yfiles.client.tiles.MoveSelectionMode(_224,_225,_226);},createRectangularSelectionMode:function(_227,_228,_229){return new yfiles.client.tiles.RectangularSelectionMode(_227,_228,_229);},createEditLabelMode:function(_22a){return new yfiles.client.tiles.EditLabelMode(_22a);},createNode:function(_22b,x,y,_22c){_22b.createNode(x,y,this.nodeType);},allowEdgeCreation:function(flag){this._allowEdgeCreation=flag;},allowNodeCreation:function(flag){this._allowNodeCreation=flag;},allowMoveSelection:function(flag){this._allowMoveSelection=flag;},allowLabelEditing:function(flag){this._allowLabelEditing=flag;},allowElementRemoval:function(flag){this._allowElementRemoval=flag;},doAllowEdgeCreation:function(){return this._allowEdgeCreation;},doAllowNodeCreation:function(){return this._allowNodeCreation;},doAllowMoveSelection:function(){return this._allowMoveSelection;},doAllowLabelEditing:function(){return this._allowLabelEditing;},doAllowElementRemoval:function(){return this._allowElementRemoval;},getCreateEdgeMode:function(){return this._createEdgeMode;},getMoveSelectionMode:function(){return this._moveSelectionMode;},getEditLabelMode:function(){return this._editLabelMode;},setCreateEdgeMode:function(_22d){this._createEdgeMode=_22d;},setMoveSelectionMode:function(_22e){this._moveSelectionMode=_22e;},setEditLabelMode:function(_22f){this._editLabelMode=_22f;},getSelection:function(){return this._selection;},clearSelection:function(){this._selection.clear();},activate:function(){this.inherited(arguments);this._canvas.fix();this.setCursor("crosshair","crosshair");},deactivate:function(){this._selection.clear();this._canvas.unhighlightAll();this._canvas.release();this.setCursor("default","default");this.inherited(arguments);},editLabel:function(id){if(this.doAllowLabelEditing()){var _230=this.getEditLabelMode();if(_230){_230.nodeOrLabel=id;this.setChild(_230);}}},removeElements:function(_231,ids){if(this.doAllowElementRemoval()){_231.remove(ids);}},getEdgeTestSensitivity:function(){return this._edgeTestSensitivity;},setEdgeTestSensitivity:function(_232){this._edgeTestSensitivity=_232;this._hitTest.setEdgeTestSensitivity(this._edgeTestSensitivity/this._canvas.zoom);},_onMouseOverNode:function(_233){this._currentNode=_233;this.setCursor("pointer","crosshair");},_onMouseOutNode:function(_234){this._currentNode=null;this.restoreCursor();},_onMouseOverNodeLabel:function(_235){var _236=this._canvas.getHitTest().getLabelInfo(_235);if(_236){this._currentNode=_236.mainElementId;}this.setCursor("pointer","crosshair");},_onMouseOutNodeLabel:function(_237){this._currentNode=null;this.restoreCursor();},_onMouseOverEdge:function(){this.setCursor("pointer","crosshair");},_onMouseOutEdge:function(){this.restoreCursor();},_onMouseDown:function(evt){var info=this._canvas.getLastHitInfo();var _238=yfiles.client.tiles.HitTest.getElementType(info);if(_238!="Node"&&_238!="NodeLabel"){this._currentNode=null;if(this._selectNodes){this.restoreCursor();}}this._mouseDown=true;},_onMouseUp:function(evt){this._mouseDown=false;},_onClickNodeOrEdge:function(id,info,evt){this._updateSelection(id,info,evt);},_onClickNodeLabel:function(_239,info,evt){var _23a=this._canvas.getHitTest().getLabelInfo(_239);if(_23a){var _23b=_23a.mainElementId;this._updateSelection(_23b,info,evt);}},_onClickPaper:function(info,evt){if(!evt.ctrlKey&&!evt.shiftKey&&!evt.altKey){var _23c=this._selection.getSize();this.clearSelection();if(_23c==0&&this.doAllowNodeCreation()){var _23d=this._canvas;var _23e=_23d.getWorldCoordinates();this.createNode(_23d.getGraph(),_23e.x,_23e.y,this.nodeType);}}},_onMouseMove:function(evt){if(this._mouseDown){this._mouseDown=false;if(this._currentNode){if(this._selection){if(!this._selection.isSelected(this._currentNode)){if(this._hierarchy&&this._strictlyInsideGroupNode(this._currentNode)){this._startSelection(evt);}else{this._startCreateEdge();}}else{this._startMoveSelection();}}else{if(!this._hierarchy||!this._strictlyInsideGroupNode(this._currentNode)){this._startCreateEdge();}}}else{if(this._selection){this._startSelection(evt);}}}},_onKeyPress:function(evt){if(this._canvas.isMouseOver()&&evt.keyCode==dojo.keys.DELETE){var _23f=this._selection.get();this.removeElements(this.getGraph(),_23f);}},_attachEventListeners:function(){if(this._connectHandles.length!=0){return;}this._canvas.fix();this._connectHandles=[dojo.connect(this._canvas,"onMouseDown",this,"_onMouseDown"),dojo.connect(this._canvas,"onMouseUp",this,"_onMouseUp"),dojo.connect(this._canvas,"onClickPaper",this,"_onClickPaper"),dojo.connect(this._canvas,"onMouseMove",this,"_onMouseMove"),dojo.connect(this._canvas,"viewPortChanged",this,"_viewPortChanged")];this._connectHandles.push(dojo.connect(this._canvas,"onMouseOverNode",this,"_onMouseOverNode"));this._connectHandles.push(dojo.connect(this._canvas,"onMouseOutNode",this,"_onMouseOutNode"));this._connectHandles.push(dojo.connect(this._canvas,"onClickNode",this,"_onClickNodeOrEdge"));this._connectHandles.push(dojo.connect(this._canvas,"onDblClickNode",this,"editLabel"));this._connectHandles.push(dojo.connect(this._canvas,"onMouseOverNodeLabel",this,"_onMouseOverNodeLabel"));this._connectHandles.push(dojo.connect(this._canvas,"onMouseOutNodeLabel",this,"_onMouseOutNodeLabel"));this._connectHandles.push(dojo.connect(this._canvas,"onClickNodeLabel",this,"_onClickNodeLabel"));this._connectHandles.push(dojo.connect(this._canvas,"onClickEdge",this,"_onClickNodeOrEdge"));this._connectHandles.push(dojo.connect(this._canvas,"onMouseOverEdge",this,"_onMouseOverEdge"));this._connectHandles.push(dojo.connect(this._canvas,"onMouseOutEdge",this,"_onMouseOutEdge"));if(this._selectNodes){this._connectHandles.push(dojo.connect(this._selection,"onAddNode",this._canvas,"highlight"));this._connectHandles.push(dojo.connect(this._selection,"onRemoveNode",this._canvas,"unhighlight"));}if(this._selectEdges){this._connectHandles.push(dojo.connect(this._selection,"onAddEdge",this._canvas,"highlight"));this._connectHandles.push(dojo.connect(this._selection,"onRemoveEdge",this._canvas,"unhighlight"));}this._connectHandles.push(dojo.connect(this._canvas,"onClickPaper",this._selection,"clear"));this._connectHandles.push(dojo.connect(this.getGraph(),"onRemove",this._selection,"removeAll"));this._connectHandles.push(dojo.connect(dojo.doc,"onkeypress",this,"_onKeyPress"));this._hitTest.setEdgeTestSensitivity(this._edgeTestSensitivity/this._canvas.zoom);var info=this._canvas.getLastHitInfo();if("Node"==yfiles.client.tiles.HitTest.getElementType(info)){this._onMouseOverNode(yfiles.client.tiles.HitTest.getHitId(info));}else{this._currentNode=null;}},_detachEventListeners:function(){dojo.forEach(this._connectHandles,dojo.disconnect);this._connectHandles=[];},_startSelection:function(evt){if(this._selection){if(!evt.ctrlKey){this.clearSelection();}this.setChild(this._rectangularSelectionMode);}},_startMoveSelection:function(){if(this.doAllowMoveSelection()){var _240=this.getMoveSelectionMode();if(_240){this.setChild(_240);}}},_startCreateEdge:function(){if(this.doAllowEdgeCreation()){var _241=this.getCreateEdgeMode();if(_241){_241.startNode=this._currentNode;this.setChild(_241);}}},_strictlyInsideGroupNode:function(node){if(this._hierarchy&&this._hierarchy.isGroupNode(node)){var _242=this._canvas.getHitTest().getBoundsForId(node);var pos=this._canvas.getWorldCoordinates();var gbw=this._groupBorderWidth;return (pos.x-_242.minX>gbw)&&(pos.y-_242.minY>gbw)&&(_242.maxX-pos.x>gbw)&&(_242.maxY-pos.y>gbw);}else{return false;}},_updateSelection:function(id,info,evt){if(this._selection){if(evt.ctrlKey&&evt.shiftKey){return;}if(!evt.ctrlKey){this.clearSelection();}if(!this._selectNodes||!this._selectEdges){var _243=yfiles.client.tiles.HitTest.getElementType(id);if((_243=="Node"&&!this._selectNodes)||(_243=="Edge"&&!this._selectEdges)){return;}}this._selection.toggle(id);}},_viewPortChanged:function(x,y,_244,_245,zoom){this._hitTest.setEdgeTestSensitivity(this._edgeTestSensitivity/zoom);}});}if(!dojo._hasResource["yfiles.client.tiles.ServerAction"]){dojo._hasResource["yfiles.client.tiles.ServerAction"]=true;dojo.provide("yfiles.client.tiles.ServerAction");dojo.declare("yfiles.client.tiles.ServerAction",null,{_id:null,_url:null,_clientContext:null,_graphName:null,_graph:null,_canvas:null,_hitTest:null,_hierarchy:null,_selection:null,_customParameter:null,_preRun:null,_postRun:null,_errorHandler:null,_customResponse:null,_worldBounds:null,constructor:function(_246){var _247={url:"./yFilesAction",error:function(_248,_249){console.error(_248);}};var args=dojo.mixin(_247,_246);if(dojo.isString(args["id"])){this.setId(args["id"]);}else{console.error("no suitable id parameter in constructor for ServerAction: "+args["id"]);return;}this.setUrl(args["url"]);this.setCanvas(args["canvas"]);this.setGraphName(args["graphName"]);this.setGraph(args["graph"]);this.setHitTest(args["hitTest"]);this.setHierarchyManager(args["hierarchy"]);this.setSelection(args["selection"]);this.setClientContext(args["clientContext"]);this.setCustomParameter(args["customParameter"]);this.setPreRun(args["preRun"]);this.setPostRun(args["postRun"]);this.setErrorHandler(args["error"]);},getId:function(){return this._id;},setId:function(id){this._id=id;},getUrl:function(){return this._url;},setUrl:function(url){this._url=url;},getClientContext:function(){return this._clientContext;},setClientContext:function(_24a){this._clientContext=_24a;},getCustomParameter:function(){return this._customParameter;},setCustomParameter:function(_24b){this._customParameter=_24b;},getHitTest:function(){var _24c=this._hitTest;if(_24c){return _24c;}else{var _24d=this.getCanvas();if(_24d){return _24d.getHitTest();}else{return null;}}},setHitTest:function(_24e){this._hitTest=_24e;},getHierarchyManager:function(){return this._hierarchy;},setHierarchyManager:function(_24f){this._hierarchy=_24f;},getSelection:function(){return this._selection;},setSelection:function(_250){this._selection=_250;},getCanvas:function(){return this._canvas;},setCanvas:function(_251){this._canvas=_251;},getGraph:function(){if(this._graph){return this._graph;}else{var _252=this.getCanvas();if(_252){return _252.getGraph();}else{var _253=this.getHierarchyManager();if(_253){return _253.getGraph();}else{return null;}}}},setGraph:function(_254){this._graph=_254;},getPreRun:function(){return this._preRun;},setPreRun:function(_255){this._preRun=_255;},getPostRun:function(){return this._postRun;},setPostRun:function(_256){this._postRun=_256;},getErrorHandler:function(){return this._errorHandler;},setErrorHandler:function(_257){this._errorHandler=_257;},getCustomResponse:function(){return this._customResponse;},getWorldBounds:function(){return this._worldBounds;},getGraphName:function(){var _258=this._graphName;if(_258){return _258;}var _259=this.getGraph();if(_259){return _259.getName();}else{var _25a=this.getHitTest();if(_25a){return _25a.getGraphName();}else{return null;}}},setGraphName:function(name){this._graphName=name;},run:function(){var _25b=this.getPreRun();var _25c=true;if(dojo.isFunction(_25b)){_25c=_25b.apply(this);}this._customResponse=null;this._worldBounds=null;if(!_25c){return;}var self=this;var _25d={url:this.getUrl(),content:this._createContent(),handleAs:"json",load:function(_25e,_25f){self._handleResponse(_25e);}};var _260=this.getErrorHandler();if(dojo.isFunction(_260)){_25d.error=_260;}dojo.xhrPost(_25d);},_createContent:function(){var _261={id:this._id};var _262=this.getGraphName();if(_262){_261.graphName=_262;var _263=this.getHitTest();if(_263){_261.hasHitTest=true;_261.hitTypes=_263.getEventMask();}if(this.getHierarchyManager()){_261.hasHierarchy=true;}}var _264=this.getCustomParameter();if(_264){_261.customParameter=_264;}var _265=this.getCanvas();if(_265){_261.hasCanvas=true;var zoom=_265.zoom;_261.width=_265.width/zoom;_261.height=_265.height/zoom;_261.zoom=zoom;_261.viewpoint=(_265.x/zoom)+","+(_265.y/zoom);var _266=_265.getMousePosition();_261.mouse=(_266.x/zoom)+","+(_266.y/zoom);}var _267=this.getSelection();if(_267){_261.hasSelection=true;var ids=_267.get();if(ids.length>0){_261.selection=ids.join(",");}}return _261;},_handleResponse:function(_268){this._customResponse=_268.customResponse;this._updateClient(_268);var _269=this.getPostRun();if(dojo.isFunction(_269)){_269.apply(this);}},_updateClient:function(_26a){var _26b=this.getGraphName();if(_26a.worldBounds){this._worldBounds=_26a.worldBounds;}if(_26a.hitTestData&&this.getHitTest()){var self=this;this.getHitTest().setData(_26a.hitTestData,function(){self._updateClientSecond(_26a);});}else{this._updateClientSecond(_26a);}},_updateClientSecond:function(_26c){if(_26c.hierarchyData&&this.getHierarchyManager()){this.getHierarchyManager().setData(_26c.hierarchyData);}if(dojo.isString(_26c.selection)&&this.getSelection()){this._handleSelection(_26c.selection);}var _26d=this.getCanvas();if(_26d){this._updateCanvas(_26c);if(_26c.refreshCanvas){_26d.pushTiles();_26d.recalculateTiles(true);}}},_handleSelection:function(_26e){if(dojo.isString(_26e)){var _26f=this.getSelection();var ids=_26e.split(",");_26f.clear();_26f.addAll(ids);}},_updateCanvas:function(_270){var _271=this.getCanvas();var _272=this.getWorldBounds();if(_272){var bb={minX:_272.x,minY:_272.y,maxX:_272.x+_272.width,maxY:_272.y+_272.height};_271.updateWorldBounds(bb,true);}if(_270.viewPoint){_271.setViewPoint(_270.viewPoint.x*_271.zoom,_270.viewPoint.y*_271.zoom);}if(_270.zoom){_271.setZoom(_270.zoom);}}});}if(!dojo._hasResource["yfiles.client.tiles.SquelchClickMode"]){dojo._hasResource["yfiles.client.tiles.SquelchClickMode"]=true;dojo.provide("yfiles.client.tiles.SquelchClickMode");dojo.declare("yfiles.client.tiles.SquelchClickMode",yfiles.client.tiles.InputMode,{_clickHandle:null,_attachEventListeners:function(){this._clickHandle=dojo.connect(this._canvas,"onClick",this,"deactivate");},_detachEventListeners:function(){dojo.disconnect(this._clickHandle);}});}if(!dojo._hasResource["yfiles.client.tiles.ZoomAreaMode"]){dojo._hasResource["yfiles.client.tiles.ZoomAreaMode"]=true;dojo.provide("yfiles.client.tiles.ZoomAreaMode");dojo.declare("yfiles.client.tiles.ZoomAreaMode",yfiles.client.tiles.InputMode,{_rubberBand:null,_hideHandle:null,_applyHandle:null,constructor:function(_273){this._rubberBand=this._labelDialog=new yfiles.client.tiles.widget.Rubberband({canvas:this._canvas,fixCanvas:true,releaseCanvas:true});this._canvas.containerNode.appendChild(this._rubberBand.domNode);},activate:function(){this.inherited(arguments);this._showZoomArea();},deactivate:function(){if(this.isActive()){this._hideZoomArea();}this.inherited(arguments);},_showZoomArea:function(){if(this._rubberBand){window.status="Click and drag to mark the zoom area.";this._rubberBand.activate(this._canvas);this._hideHandle=dojo.connect(this._rubberBand,"onDeactivated",this,"_hideZoomArea");this._applyHandle=dojo.connect(this._rubberBand,"onAreaDone",this,"_applyZoomArea");}},_hideZoomArea:function(){if(this._rubberBand){dojo.disconnect(this._hideHandle);dojo.disconnect(this._applyHandle);this._rubberBand.deactivate();window.status="";}},_applyZoomArea:function(x,y,w,h){var _274=this._canvas;if(w>9&&h>9){var cx=x+w/2;var cy=y+h/2;var _275=_274.zoom;var _276=_275*Math.min(_274.width/w,_274.height/h);_274.center(cx,cy);_274.setZoom(_276);}this.deactivate();}});}if(!dojo._hasResource["yfiles.client.tiles.widget.ViewPortMarker"]){dojo._hasResource["yfiles.client.tiles.widget.ViewPortMarker"]=true;dojo.provide("yfiles.client.tiles.widget.ViewPortMarker");dojo.declare("yfiles.client.tiles.widget.ViewPortMarker",[dijit._Widget,dijit._Templated],{templateString:"<div class=\"yFilesViewPortMarker\" dojoAttachPoint=\"marker\" style=\"padding:0pt;margin:0pt;position:absolute;display:block;font-size:1px;cursor:move;z-index:10;\"></div>",marker:null,canvasId:"",overviewId:"",lastBounds:null,canvas:null,overview:null,markerParent:null,_changeTriggered:false,_lateInitHandle:null,postCreate:function(){dojo.style(this.marker,"opacity",0.2);this.drag=new dojo.dnd.Moveable(this.marker);this.connect(this.drag,"onMoved","markerChanged");if(!this.overview){this.overview=dijit.byId(this.overviewId);}this.markerParent=this.overview.domNode;this.connect(this.overview,"viewPortChanged","overviewChanged");this.connect(this.markerParent,"ondblclick","centerMarker");if(!this.canvas){this.canvas=dijit.byId(this.canvasId);}if(this.canvas==null){this._lateInitHandle=this.connect(dijit.registry,"add","lateInitialization");}else{with(this.canvas){this.lastBounds={width:width,height:height,x:x,y:y,zoom:zoom};}this.connect(this.canvas,"viewPortChanged","canvasChanged");}},lateInitialization:function(_277){if(_277.id==this.canvasId){this.canvas=_277;with(this.canvas){this.lastBounds={width:width,height:height,x:x,y:y,zoom:zoom};}this.connect(this.canvas,"viewPortChanged","canvasChanged");this.disconnect(this._lateInitHandle);}},overviewChanged:function(){if(this.lastBounds){this.canvasChanged(this.lastBounds.x,this.lastBounds.y,this.lastBounds.width,this.lastBounds.height,this.lastBounds.zoom);}},canvasChanged:function(x,y,_278,_279,zoom){this.lastBounds={width:_278,height:_279,x:x,y:y,zoom:zoom};var _27a=this.overview.zoom/zoom;var w=Math.round(_278*_27a);var h=Math.round(_279*_27a);if(dojo.isIE){w=Math.min(w,4090);h=Math.min(h,4090);}dojo.style(this.marker,{"left":(this.overview.x-x*_27a)+"px","top":(this.overview.y-y*_27a)+"px","width":w+"px","height":h+"px"});},markerChanged:function(){if(!this._changeTriggered){this._changeTriggered=true;setTimeout(dojo.hitch(this,this._markerChanged),100);}},_markerChanged:function(){var _27b=parseInt(dojo.style(this.marker,"left"));var _27c=parseInt(dojo.style(this.marker,"top"));var _27d=this.canvas.zoom/this.overview.zoom;this.canvas.setViewPoint(_27d*(this.overview.x-_27b),_27d*(this.overview.y-_27c));this.canvas.recalculateTiles();this._changeTriggered=false;},centerMarker:function(evt){var pos=dojo.coords(this.markerParent,false);var x=evt.pageX-pos.x-parseInt(dojo.style(this.marker,"width"))/2;var y=evt.pageY-pos.y-parseInt(dojo.style(this.marker,"height"))/2;dojo.style(this.marker,"left",Math.round(x)+"px");dojo.style(this.marker,"top",Math.round(y)+"px");this.markerChanged();}});}
